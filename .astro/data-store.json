[["Map",1,2,7,8],"meta::meta",["Map",3,4,5,6],"astro-version","4.16.18","config-digest","b10687f626f4ca63","blog",["Map",9,10,81,82],"代码安全指南",{"id":9,"data":11,"body":19,"filePath":20,"digest":21,"rendered":22},{"author":12,"pubDatetime":13,"modDatetime":14,"title":9,"featured":15,"draft":15,"tags":16,"description":18},"Vanyongqi",["Date","2025-02-05T10:58:52.737Z"],["Date","2025-02-05T10:40:08.465Z"],false,[17],"代码基础","腾讯代码安全指南的阅读笔记+感悟,有舍有得.","\n 腾讯代码安全指南,原文链接 https://github.com/Tencent/secguide.\n\n **(小声bb:看原文不如看我的,我的 =  腾讯代码安全指南Plus版本)**\n\n ### 通用类\n \n### 1.1内存管理\n**1.1.1 切片长度校验**\n\n目的:防止访问到超出切片容量的索引,导致panic.\n```go\n// bad: 未判断data的长度，可导致 index out of range,访问越界.\n// 在函数 decode 中，没有检查输入数据的长度，直接访问索引，可能导致 index out of range 错误。\nfunc decode(data []byte) bool {\n\tif data[0] == 'F' && data[1] == 'U' && data[2] == 'Z' && data[3] == 'Z' && data[4] == 'E' && data[5] == 'R' {\n\t\tfmt.Println(\"Bad\")\n\t\treturn true\n\t}\n\treturn false\n}\n\n// bad: slice bounds out of range\n// 在函数 foo 中，尝试访问切片超出范围的部分，导致 slice bounds out of range 错误\nfunc foo() {\n\tvar slice = []int{0, 1, 2, 3, 4, 5, 6}\n\tfmt.Println(slice[:10])\n}\n\n// good: 使用data前应判断长度是否合法\nfunc decode(data []byte) bool {\n\tif len(data) == 6 {\n\t\tif data[0] == 'F' && data[1] == 'U' && data[2] == 'Z' && data[3] == 'Z' && data[4] == 'E' && data[5] == 'R' {\n\t\t\tfmt.Println(\"Good\")\n\t\t\treturn true\n\t\t}\n\t}\n\treturn false\n}\n```\n**1.1.2** nil指针判断\n\n进行指针操作时,必须要对指针进行空指针判断,防止panic(go对空指针进行解引用,会panic,c语言则是segmentation fault).\n\n在访问 packet.Data 之前，先判断它是否 nil,如果 Data 为空，就不会继续访问其字段，从而避免 panic,尤其是结构体Unmarshal.\n```go\ntype Packet struct {\n    PackeyType        uint8\n    PackeyVersion     uint8\n    Data              *Data\n}\ntype Data struct {\n    Stat    uint8\n    Len     uint8\n    Buf     [8]byte\n}\nfunc (p *Packet) UnmarshalBinary(b []byte) error {\n    if len(b) \u003C 2 {\n       return io.EOF\n    }\n    p.PackeyType = b[0]\n    p.PackeyVersion = b[1]\n    // 若长度等于2，那么不会new Data\n    if len(b) > 2 {\n        p.Data = new(Data)\n        // Unmarshal(b[i:], p.Data)\n    }\n    return nil\n}\n// bad: 未判断指针是否为nil\nfunc main() {\n    packet := new(Packet)\n    data := make([]byte, 2)\n    if err := packet.UnmarshalBinary(data); err != nil {\n        fmt.Println(\"Failed to unmarshal packet\")\n        return\n    }\n    fmt.Printf(\"Stat: %v\\n\", packet.Data.Stat)\n}\n// good: 判断Data指针是否未nil\nfunc main() {\n    packet := new(Packet)\n    data := make([]byte, 2)\n    if err := packet.UnmarshalBinary(data); err != nil {\n        fmt.Println(\"Failed to unmarshal packet\")\n        return\n    }\n    if packet.Data == nil {\n        return\n    }\n    fmt.Printf(\"Stat: %v\\n\", packet.Data.Stat)\n}\n```\n**1.1.3 整数安全** \n因为数是有边界的int32(65536),int64的长度都是不一样的.\n\n- **在进行数字运算操作时，需要做好长度限制，防止外部输入运算导致异常:**\n- 确保无符号整数运算时不会反转\n- 确保有符号整数运算时不会出现溢出\n- 确保整型转换时不会出现截断错误\n- 确保整型转换时不会出现符号错误\n\n**以下场景必须严格进行长度限制**\n\n- 作为数组索引\n- 作为对象的长度或者大小\n- 作为数组的边界（如作为循环计数器）\n\n**1.1.4 make分配长度验证**\n\n在进行make分配内存时，需要对外部可控的长度进行校验，防止程序panic。\n```go\n// bad\nfunc parse(lenControlByUser int, data[] byte) {\n    size := lenControlByUser\n    //对外部传入的size，进行长度判断以免导致panic\n    buffer := make([]byte, size)\n    copy(buffer, data)\n}\n// good\nfunc parse(lenControlByUser int, data[] byte) ([]byte, error){\n    size := lenControlByUser\n    //限制外部可控的长度大小范围\n    if size > 64*1024*1024 {\n        return nil, errors.New(\"value too large\")\n    }\n    buffer := make([]byte, size)\n    copy(buffer, data)\n    return buffer, nil\n}\n```\n**1.1.5 禁止SetFinalizer和指针循环引用同时使用** \n\n这个其实用到的地方不多,尽量不要产生循环引用.\n\n当一个对象从被GC选中到移除内存之前，runtime.SetFinalizer()都不会执行，即使程序正常结束或者发生错误。由指针构成的“循环引用”虽然能被GC正确处理，但由于无法确定Finalizer依赖顺序，从而无法调用runtime.SetFinalizer()，导致目标对象无法变成可达状态，从而造成内存无法被回收。\n\n```go\n// bad\nfunc foo() {\n    var a, b Data\n    a.o = &b\n    b.o = &a\n    //指针循环引用，SetFinalizer()无法正常调用\n    runtime.SetFinalizer(&a, func(d *Data) {\n        fmt.Printf(\"a %p final.\\n\", d)\n    })\n    runtime.SetFinalizer(&b, func(d *Data) {\n        fmt.Printf(\"b %p final.\\n\", d)\n    })\n}\nfunc main() {\n    for {\n        foo()\n        time.Sleep(time.Millisecond)\n    }\n}\n```\n\n**1.1.6 禁止重复释放channel**\n\n重复释放一般存在于异常流程判断中，如果恶意攻击者构造出异常条件使程序重复释放channel，则会触发运行时恐慌，从而造成DoS攻击。\n```go\n// bad\nfunc foo(c chan int) {\n    defer close(c)\n    err := processBusiness()\n    if err != nil {\n        c \u003C- 0\n        close(c) // 重复释放channel\n        return\n    }\n    c \u003C- 1\n}\n// good\nfunc foo(c chan int) {\n    defer close(c) // 使用defer延迟关闭channel\n    err := processBusiness()\n    if err != nil {\n        c \u003C- 0\n        return\n    }\n    c \u003C- 1\n}\n```\n**1.1.7 确保每个go routine都能退出**\n\n启动一个协程就会做一个入栈操作，在系统不退出的情况下，协程也没有设置退出条件，则相当于协程失去了控制，它占用的资源无法回收，可能会导致内存泄露.\n```go\n// bad: 协程没有设置退出条件\nfunc doWaiter(name string, second int) {\n    for {\n        time.Sleep(time.Duration(second) * time.Second)\n        fmt.Println(name, \" is ready!\")\n    }\n}\n// good: 使用信号通道控制协程退出\nfunc doWaiter(name string, second int, quit chan struct{}) {\n    for {\n        select {\n        case \u003C-quit:\n            fmt.Println(name, \" is exiting!\")\n            return\n        default:\n            time.Sleep(time.Duration(second) * time.Second)\n            fmt.Println(name, \" is ready!\")\n        }\n    }\n}\n```\n**1.1.8 不使用unsafe包**\n\n由于unsafe包绕过了 Golang 的内存安全原则，一般来说使用该库是不安全的，可导致内存破坏，尽量避免使用该包。若必须要使用unsafe操作指针，必须做好安全校验。\n```go\n// bad: 通过unsafe操作原始指针\nfunc unsafePointer() {\n    b := make([]byte, 1)\n    foo := (*int)(unsafe.Pointer(uintptr(unsafe.Pointer(&b[0])) + uintptr(0xfffffffe)))\n    fmt.Print(*foo + 1)\n}\n// [signal SIGSEGV: segmentation violation code=0x1 addr=0xc100068f55 pc=0x49142b]\n```\n**1.1.9 不使用slice作为函数入参 (不太赞同)**\n\n>slice是引用类型，在作为函数入参时采用的是地址传递，对slice的修改也会影响原始数据.\n\n**但是**\n- 传递 slice 不会复制底层数组，适合处理大数据集，避免不必要的内存开销。\n- slice 可以方便地传递部分数据，适合需要操作子集的情况。\n- 如果函数需要修改 slice 的元素，直接传递 slice 是合适的，因为 slice 是引用类型，修改会反映在原 slice 上。 我觉得这是优点.\n\n如果希望函数不修改原 slice，可以传递 slice 的副本或使用只读数据结构。\n```go\nfunc ownSlice(s []int) []int {\n    newSlice := make([]int, len(s))\n    copy(newSlice, s)\n    return newSlice\n}\n```\n###  1.2文件操作\n**1.2.1  路径穿越检查**\n\n在进行文件操作时，如果对外部传入的文件名未做限制，可能导致任意文件读取或者任意文件写入，严重可能导致代码执行。\n```go\n// bad: 任意文件读取\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    //类型1\n    path := r.URL.Query()[\"path\"][0]\n    // 未过滤文件路径，可能导致任意文件读取\n    data, _ := ioutil.ReadFile(path)\n    w.Write(data)\n    // 攻击者可以通过构造特殊的 URL 参数来读取系统中的任意文件，例如：\n    // http://example.com/handler?path=/etc/passwd\n    // http://example.com/handler?path=../../etc/shadow\n\n    //类型2\n    // 对外部传入的文件名变量，还需要验证是否存在../等路径穿越的文件名\n    // 虽然使用了 filepath.Join ，但仍然可以通过 ../ 进行目录遍历，\n    data, _ = ioutil.ReadFile(filepath.Join(\"/home/user/\", path))\n    w.Write(data)\n    // http://example.com/handler?path=../../../etc/passwd\n    /*--------------------------分割线-------------------------*/\n// 攻击者的请求示例\n    req, _ := http.NewRequest(\"GET\", \"http://example.com/handler?path=/etc/passwd\", nil)\n// 或者使用相对路径\n    req, _ := http.NewRequest(\"GET\", \"http://example.com/handler?path=../../../../etc/passwd\", nil)\n}\n\n // 安全实现\nfunc safeHandler(w http.ResponseWriter, r *http.Request) {\n    // 1. 获取并验证路径参数\n    paths, ok := r.URL.Query()[\"path\"]\n    if !ok || len(paths) == 0 {\n        http.Error(w, \"missing path parameter\", http.StatusBadRequest)\n        return\n    }\n    userPath := paths[0]\n\n    // 2. 定义允许访问的根目录\n    baseDir := \"/home/user/safe_files\"\n\n    // 3. 清理和规范化路径\n    cleanPath := filepath.Clean(userPath)\n    \n    // 4. 构建完整的文件路径\n    fullPath := filepath.Join(baseDir, cleanPath)\n\n    // 5. 验证最终路径是否在允许的目录内\n    if !strings.HasPrefix(fullPath, baseDir) {\n        http.Error(w, \"access denied\", http.StatusForbidden)\n        return\n    }\n\n    // 6. 验证文件是否存在\n    if _, err := os.Stat(fullPath); os.IsNotExist(err) {\n        http.Error(w, \"file not found\", http.StatusNotFound)\n        return\n    }\n\n    // 7. 安全地读取文件\n    data, err := ioutil.ReadFile(fullPath)\n    if err != nil {\n        http.Error(w, \"failed to read file\", http.StatusInternalServerError)\n        return\n    }\n\n    w.Write(data)\n}\n\n```\n任意文件写入案例\n- 代码直接使用压缩文件中的文件名（ f.Name ）\n- 攻击者可以构造包含 ../ 的文件名\n- 即使使用了 filepath.Abs ，仍然无法防止路径穿越\n\n```go\n// bad: 任意文件写入\nfunc unzip(f string) {\n    r, _ := zip.OpenReader(f)\n    for _, f := range r.File {\n        p, _ := filepath.Abs(f.Name)\n        // 未验证压缩文件名，可能导致../等路径穿越，任意文件路径写入\n        ioutil.WriteFile(p, []byte(\"present\"), 0640)\n    }\n}\n//////////////////分割线////////////////////\nfunc createEvilZip() error {\n    // 创建恶意 ZIP 文件\n    zipfile, err := os.Create(\"evil.zip\")\n    if err != nil {\n        return err\n    }\n    defer zipfile.Close()\n\n    // 创建 ZIP writer\n    zipWriter := zip.NewWriter(zipfile)\n    defer zipWriter.Close()\n\n    // 创建恶意文件路径\n    evilPaths := []string{\n        \"../../../etc/passwd\",                 // Unix 系统敏感文件\n        \"..\\\\..\\\\..\\\\windows\\\\system.ini\",    // Windows 系统文件\n        \"../../../root/.ssh/authorized_keys\",  // SSH 密钥\n    }\n\n    // 将恶意路径添加到 ZIP 文件中\n    for _, path := range evilPaths {\n        _, err := zipWriter.Create(path)\n        if err != nil {\n            return err\n        }\n    }\n\n    return nil\n}\n//////////////////分割线////////////////////\n/*\n当这个恶意 ZIP 文件被不安全的解压程序处理时，会尝试写入到这些敏感路径。这就是为什么在解压 ZIP 文件时必须：\n\n1. 验证最终路径是否在允许的目录内\n2. 检查路径中是否包含 ../ 或 ..\\\\ 等穿越字符\n3. 使用安全的解压函数（如前面提到的 safeUnzip ）\n*/\n\n\n// good: 检查压缩的文件名是否包含..路径穿越特征字符，防止任意写入\nfunc unzipGood(f string) bool {\n    r, err := zip.OpenReader(f)\n    if err != nil {\n        fmt.Println(\"read zip file fail\")\n        return false\n    }\n    for _, f := range r.File {\n        p, _ := filepath.Abs(f.Name)\n        if !strings.Contains(p, \"..\") {\n            ioutil.WriteFile(p, []byte(\"present\"), 0640)\n        }\n    }\n    return true\n}\n\n// 完整的解压函数案例:\nfunc secureUnzip(zipFile, destDir string) error {\n    // 1. 规范化目标目录路径\n    absDestDir, err := filepath.Abs(destDir)\n    if err != nil {\n        return fmt.Errorf(\"invalid destination path: %v\", err)\n    }\n\n    // 2. 打开并验证 ZIP 文件\n    reader, err := zip.OpenReader(zipFile)\n    if err != nil {\n        return fmt.Errorf(\"failed to open zip: %v\", err)\n    }\n    defer reader.Close()\n\n    // 3. 遍历处理所有文件\n    for _, file := range reader.File {\n        // 4. 安全检查\n        if err := validateZipFile(file, absDestDir); err != nil {\n            return fmt.Errorf(\"security check failed: %v\", err)\n        }\n\n        // 5. 处理文件\n        if err := extractFile(file, absDestDir); err != nil {\n            return fmt.Errorf(\"extraction failed: %v\", err)\n        }\n    }\n    return nil\n}\n\nfunc validateZipFile(file *zip.File, destDir string) error {\n    // 1. 路径规范化\n    destPath := filepath.Join(destDir, file.Name)\n    destPath = filepath.Clean(destPath)\n\n    // 2. 路径穿越检查\n    if !strings.HasPrefix(destPath, destDir) {\n        return fmt.Errorf(\"path traversal attempt detected: %s\", file.Name)\n    }\n\n    // 3. 文件大小检查\n    if file.UncompressedSize64 > 100*1024*1024 { // 100MB 限制\n        return fmt.Errorf(\"file too large: %s\", file.Name)\n    }\n\n    // 4. 文件权限检查\n    if file.Mode()&os.ModeSymlink != 0 {\n        return fmt.Errorf(\"symlinks not allowed: %s\", file.Name)\n    }\n\n    // 5. 文件名合法性检查\n    if strings.Contains(file.Name, \"..\") || strings.Contains(file.Name, \"//\") {\n        return fmt.Errorf(\"invalid file path: %s\", file.Name)\n    }\n\n    return nil\n}\n\nfunc extractFile(file *zip.File, destDir string) error {\n    // 1. 构建目标路径\n    destPath := filepath.Join(destDir, file.Name)\n    \n    // 2. 创建必要的目录\n    if err := os.MkdirAll(filepath.Dir(destPath), 0755); err != nil {\n        return err\n    }\n\n    // 3. 创建目标文件\n    destFile, err := os.OpenFile(destPath, os.O_WRONLY|os.O_CREATE|os.O_TRUNC, file.Mode())\n    if err != nil {\n        return err\n    }\n    defer destFile.Close()\n\n    // 4. 打开源文件\n    srcFile, err := file.Open()\n    if err != nil {\n        return err\n    }\n    defer srcFile.Close()\n\n    // 5. 限制读取速度和大小\n    limitedReader := &io.LimitedReader{\n        R: srcFile,\n        N: 100 * 1024 * 1024, // 100MB 限制\n    }\n\n    // 6. 复制文件内容\n    _, err = io.Copy(destFile, limitedReader)\n    return err\n}\n\n/*\n安全措施：\n1. 完整的路径验证\n2. 文件大小限制\n3. 符号链接检查\n4. 文件名合法性验证\n5. 资源使用限制\n6. 错误处理和资源清理\n7. 权限控制\n这样的实现能够有效防止各种攻击，包括：\n\n- 路径穿越\n- 拒绝服务（通过大文件）\n- 符号链接攻击\n- 资源耗尽攻击\n*/\n```\n**1.2.1 文件访问权限**\n 根据创建文件的敏感性设置不同级别的访问权限，以防止敏感数据被任意权限用户读取。例如，设置文件权限为：-rw-r-----\n```go\nioutil.WriteFile(p, []byte(\"present\"), 0640)\n// 创建一个普通文件，所有人都可以读\nerr := ioutil.WriteFile(\"public.txt\", []byte(\"Hello\"), 0644)\n\n// 创建一个敏感配置文件，只有所有者可以读写\nerr = ioutil.WriteFile(\"config.json\", []byte(\"secret\"), 0600)\n\n// 创建一个组内共享文件，组内成员可读\nerr = ioutil.WriteFile(\"group_share.txt\", []byte(\"group data\"), 0640)\n```\n### 1.3 系统接口\n1.3.1【必须】命令执行检查\n>使用exec.Command、exec.CommandContext、syscall.StartProcess、os.StartProcess等函数时，第一个参数（path）直接取外部输入值时，应使用白名单限定可执行的命令范围，不允许传入bash、cmd、sh等命令；\n\n>使用exec.Command、exec.CommandContext等函数时，通过bash、cmd、sh等创建shell，-c后的参数（arg）拼接外部输入，应过滤\\n $ & ; | ‘ “ ( ) `等潜在恶意字符；\n\n主要安全措施\n1. 命令白名单 ：\n   - 明确定义允许执行的命令\n   - 拒绝执行未知命令\n2. 危险字符过滤 ：\n   - 过滤可能导致命令注入的字符\n   - 包括 `\\n $ & ; | ' \" ( ) `` 等\n3. 参数化处理 ：\n   - 避免字符串拼接\n   - 使用命令参数方式传递值\n4. 超时控制 ：\n   - 使用 Context 控制执行时间\n   - 防止命令执行时间过长\n5. 错误处理 ：\n   - 详细的错误信息\n   - 合适的错误返回\n这样的实现可以有效防止：\n        - 命令注入攻击\n        - 恶意命令执行\n        - 资源耗尽攻击\n     - 拒绝服务攻击\n```go\n// 不安全的命令执行示例\nfunc unsafeExec(command string) error {\n    // 直接使用外部输入作为命令，非常危险\n    cmd := exec.Command(command)  // 危险：直接使用外部输入\n    return cmd.Run()\n}\n\nfunc unsafeShellExec(argument string) error {\n    // 通过 shell 执行命令，并拼接外部输入，非常危险\n    cmd := exec.Command(\"bash\", \"-c\", \"echo \" + argument)  // 危险：直接拼接外部输入\n    return cmd.Run()\n}\n\n// 安全的命令执行实现\nfunc safeExec(command string) error {\n    // 定义允许执行的命令白名单\n    allowedCommands := map[string]bool{\n        \"git\":    true,\n        \"ls\":     true,\n        \"whoami\": true,\n    }\n\n    // 检查命令是否在白名单中\n    if !allowedCommands[command] {\n        return fmt.Errorf(\"command not allowed: %s\", command)\n    }\n\n    cmd := exec.Command(command)\n    return cmd.Run()\n}\n\n// 安全的 shell 命令执行\nfunc safeShellExec(argument string) error {\n    // 定义不允许的字符\n    dangerousChars := []string{\n        \"\\n\", \"$\", \"&\", \";\", \"|\", \"'\", \"\\\"\", \"(\", \")\", \"`\",\n    }\n\n    // 检查是否包含危险字符\n    for _, char := range dangerousChars {\n        if strings.Contains(argument, char) {\n            return fmt.Errorf(\"dangerous character found in argument: %s\", char)\n        }\n    }\n\n    // 使用参数化方式执行命令\n    cmd := exec.Command(\"echo\", argument)  // 安全：作为参数传入\n    return cmd.Run()\n}\n\n// 使用 Context 控制命令执行超时\nfunc safeExecWithTimeout(command string) error {\n    // 创建带超时的 context\n    ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)\n    defer cancel()\n\n    // 检查命令白名单\n    allowedCommands := map[string]bool{\n        \"git\": true,\n        \"ls\":  true,\n    }\n\n    if !allowedCommands[command] {\n        return fmt.Errorf(\"command not allowed: %s\", command)\n    }\n\n    // 使用 CommandContext 执行命令\n    cmd := exec.CommandContext(ctx, command)\n    return cmd.Run()\n}\n```\n### 1.4 通信安全\n**1.4.1 网络通信采用TLS方式**\n\n明文传输的通信协议目前已被验证存在较大安全风险，被中间人劫持后可能导致许多安全风险，因此必须采用至少TLS的安全通信方式保证通信安全，例如gRPC/Websocket都使用TLS1.3。\n```go\n// good\nfunc main() {\n  http.HandleFunc(\"/\", func (w http.ResponseWriter, req *http.Request) {\n    w.Header().Add(\"Strict-Transport-Security\", \"max-age=63072000; includeSubDomains\")\n    w.Write([]byte(\"This is an example server.\\n\"))\n  })\n  //服务器配置证书与私钥\n  log.Fatal(http.ListenAndServeTLS(\":443\", \"yourCert.pem\", \"yourKey.pem\", nil))\n}\n```\n**1.4.2 TLS启用证书验证** \n\nTLS证书应当是有效的、未过期的，且配置正确的域名，生产环境的服务端应启用证书验证。\n```go\n// bad\nimport (\n    \"crypto/tls\"\n    \"net/http\"\n)\nfunc doAuthReq(authReq *http.Request) *http.Response {\n    tr := &http.Transport{\n        TLSClientConfig: &tls.Config{InsecureSkipVerify: true},\n        //InsecureSkipVerify: true 完全禁用证书验证\n    }\n    client := &http.Client{Transport: tr}\n    res, _ := client.Do(authReq)\n    return res\n}\n// good\nimport (\n    \"crypto/tls\"\n    \"net/http\"\n)\nfunc doAuthReq(authReq *http.Request) *http.Response {\n    tr := &http.Transport{\n        TLSClientConfig: &tls.Config{InsecureSkipVerify: false},\n    }\n    client := &http.Client{Transport: tr}\n    res, _ := client.Do(authReq)\n    return res\n} \n```\n### 1.5 敏感数据保护\n**1.5.1【必须】敏感信息访问**\n\n禁止将敏感信息硬编码在程序中，既可能会将敏感信息暴露给攻击者，也会增加代码管理和维护的难度\n使用配置中心系统统一托管密钥等敏感信息\n\n**1.5.2【必须】敏感数据输出**\n\n只输出必要的最小数据集，避免多余字段暴露引起敏感信息泄露\n不能在日志保存密码（包括明文密码和密文密码）、密钥和其它敏感信息\n对于必须输出的敏感信息，必须进行合理脱敏展示\n```go\n// bad\nfunc serve() {\n    http.HandleFunc(\"/register\", func(w http.ResponseWriter, r *http.Request) {\n        r.ParseForm()\n        user := r.Form.Get(\"user\")\n        pw := r.Form.Get(\"password\")\n        log.Printf(\"Registering new user %s with password %s.\\n\", user, pw)\n    })\n    http.ListenAndServe(\":80\", nil)\n}\n// good\nfunc serve1() {\n    http.HandleFunc(\"/register\", func(w http.ResponseWriter, r *http.Request) {\n        r.ParseForm()\n        user := r.Form.Get(\"user\")\n        pw := r.Form.Get(\"password\")\n        log.Printf(\"Registering new user %s.\\n\", user)\n        // ...\n        use(pw)\n    })\n    http.ListenAndServe(\":80\", nil)\n}\n```\n**1.5.3【必须】敏感数据存储**\n\n敏感数据应使用SHA2、RSA等算法进行加密存储\n敏感数据应使用独立的存储层，并在访问层开启访问控制\n包含敏感信息的临时文件或缓存一旦不再需要应立刻删除\n\n**1.5.4【必须】异常处理和日志记录**\n\n- 应合理使用panic、recover、defer处理系统异常，避免出错信息输出到前端\n```go\ndefer func () {\n        if r := recover(); r != nil {\n            fmt.Println(\"Recovered in start()\")\n        }\n    }()\n```\n- 对外环境禁止开启debug模式，或将程序运行日志输出到前端. \n这点很重要,我之前实习所在的公司就曾经将debug模式的代码包发成正式包 = =.\n### 1.6加密解密\n**1.6.1【必须】不得硬编码密码/密钥 常识**\n\n在进行用户登陆，加解密算法等操作时，不得在代码里硬编码密钥或密码，可通过变换算法或者配置等方式设置密码或者密钥。前后端加密算法保持一致即可.记得我实习的时候,写过一个夭折的产品,前后端算法加密类型不一致,挺搞笑的,我下意识默认用sha256了,调试的时候就很懵逼,沟通很重要的.\n```go\n// bad\nconst (\n    user     = \"dbuser\"\n    password = \"s3cretp4ssword\"\n)\nfunc connect() *sql.DB {\n    connStr := fmt.Sprintf(\"postgres://%s:%s@localhost/pqgotest\", user, password)\n    db, err := sql.Open(\"postgres\", connStr)\n    if err != nil {\n        return nil\n    }\n    return db\n}\n// bad\nvar (\n    commonkey = []byte(\"0123456789abcdef\")\n)\nfunc AesEncrypt(plaintext string) (string, error) {\n    block, err := aes.NewCipher(commonkey)\n    if err != nil {\n        return \"\", err\n    }\n}\n```\n\n**1.6.2【必须】密钥存储安全**\n\n在使用对称密码算法时，需要保护好加密密钥。当算法涉及敏感、业务数据时，可通过非对称算法协商加密密钥。其他较为不敏感的数据加密，可以通过变换算法等方式保护密钥。\n不要使用弱密码算法:\n>crypto/des，crypto/md5，crypto/sha1，crypto/rc4等。\n### 1.7正则表达式 \n**1.7.1【推荐】使用regexp进行正则表达式匹配**\n正则表达式能不用还是不要用哈,很耗费性能.\n\n正则表达式编写不恰当可被用于DoS攻击，造成服务不可用，推荐使用regexp包进行正则表达式匹配。regexp保证了线性时间性能和优雅的失败：对解析器、编译器和执行引擎都进行了内存限制。但regexp不支持以下正则表达式特性，如业务依赖这些特性，则regexp不适合使用。\n回溯引用Backreferences和查看Lookaround\n```go\n// good\nmatched, err := regexp.MatchString(`a.b`, \"aaxbb\")\nfmt.Println(matched) // true\nfmt.Println(err)     // nil (regexp is valid)\n```\n\n\n### 后台类\n### 1.1 输入校验\n**1.1.1 按照数据进行校验**\n所有外部输入的参数，应使用validator进行白名单校验，校验内容包括但不限于数据长度、数据范围、数据类型与格式，校验不通过的应当拒绝.\n\n```go\nimport (\n    \"fmt\"\n    \"github.com/go-playground/validator/v10\"\n)\n\n// 1. 基础类型验证\nfunc basicValidation() {\n    validate := validator.New()\n    \n    email := \"invalid-email\"\n    err := validate.Var(email, \"required,email\")\n    if err != nil {\n        fmt.Println(\"邮箱格式错误\")\n    }\n}\n\n// 2. 结构体验证\ntype User struct {\n    ID        int       `validate:\"required\"`\n    Name      string    `validate:\"required,min=2,max=50\"`\n    Age       uint8     `validate:\"required,gte=18,lte=120\"`\n    Email     string    `validate:\"required,email\"`\n    Phone     string    `validate:\"required,len=11\"`\n    Password  string    `validate:\"required,min=8\"`\n}\n\nfunc structValidation() {\n    validate := validator.New()\n    \n    user := &User{\n        ID:       1,\n        Name:     \"张三\",\n        Age:      16,  // 验证会失败，因为年龄小于18\n        Email:    \"zhangsan@example.com\",\n        Phone:    \"13800138000\",\n        Password: \"password123\",\n    }\n    \n    err := validate.Struct(user)\n    if err != nil {\n        validationErrors := err.(validator.ValidationErrors)\n        for _, e := range validationErrors {\n            fmt.Printf(\"字段: %s, 错误: %s\\n\", e.Field(), e.Tag())\n        }\n    }\n}\n\n// 3. 自定义验证规则\nfunc customValidation() {\n    validate := validator.New()\n    \n    // 注册自定义验证器\n    validate.RegisterValidation(\"chinese_mobile\", func(fl validator.FieldLevel) bool {\n        value := fl.Field().String()\n        // 简单的中国手机号验\n```\nGoFrame 框架提供了类似的数据校验功能，通过 g.Validator() 或者 g.Validator().Rules() 来实现，主要通过 gvalid 包提供验证功能\n```go\nimport (\n    \"github.com/gogf/gf/v2/util/gvalid\"\n    \"github.com/gogf/gf/v2/frame/g\"\n)\n\n// 1. 结构体验证\ntype User struct {\n    Name     string `v:\"required|length:6,30#请输入用户名|用户名长度应当在:min到:max之间\"`\n    Age      uint   `v:\"required|between:18,60#请输入年龄|年龄应当在:min到:max之间\"`\n    Email    string `v:\"required|email#请输入邮箱|邮箱格式不正确\"`\n    Password string `v:\"required|length:6,30#请输入密码|密码长度应当在:min到:max之间\"`\n}\n\nfunc validateStruct() {\n    user := &User{\n        Name:     \"john\",\n        Age:      16,\n        Email:    \"john@example\",\n        Password: \"123\",\n    }\n    \n    // 执行校验\n    if err := g.Validator().Data(user).Run(ctx); err != nil {\n        fmt.Println(err.FirstString()) // 输出第一条错误信息\n    }\n}\n\n// 2. 单个数据验证\nfunc validateSingle() {\n    // 验证单个数据\n    if err := g.Validator().Data(\"john@example\").Rules(\"required|email\").Run(ctx); err != nil {\n        fmt.Println(err.FirstString())\n    }\n}\n\n// 3. 自定义验证规则\nfunc customValidation() {\n    // 注册自定义规则\n    if err := gvalid.RegisterRule(\"chinese_mobile\", func(ctx context.Context, in gvalid.RuleFuncInput) error {\n        if !regexp.MustCompile(`^1[3-9]\\d{9}$`).MatchString(in.Value.String()) {\n            return errors.New(\"手机号格式错误\")\n        }\n        return nil\n    }); err != nil {\n        panic(err)\n    }\n\n    // 使用自定义规则\n    phone := \"12345678901\"\n    if err := g.Validator().Data(phone).Rules(\"chinese_mobile\").Run(ctx); err != nil {\n        fmt.Println(err.FirstString())\n    }\n}\n\n// 4. Map数据验证\nfunc validateMap() {\n    data := g.Map{\n        \"name\":  \"john\",\n        \"age\":   16,\n        \"email\": \"john@example\",\n    }\n    rules := g.Map{\n        \"name\":  \"required|length:6,30\",\n        \"age\":   \"required|between:18,60\",\n        \"email\": \"required|email\",\n    }\n    messages := g.Map{\n        \"name\":  \"用户名不能为空|用户名长度应当在{min}到{max}之间\",\n        \"age\":   \"请输入年龄|年龄应当在{min}到{max}之间\",\n        \"email\": \"请输入邮箱|邮箱格式不正确\",\n    }\n    \n    if err := g.Validator().Data(data).Rules(rules).Messages(messages).Run(ctx); err != nil {\n        fmt.Println(err.FirstString())\n    }\n}\n```\n无法通过白名单校验的应使用html.EscapeString、text/template或bluemonday对\u003C, >, &, ',\"等字符进行过滤或编码.\n```go\n  import(\n      \"text/template\"\n  )\n  // TestHTMLEscapeString HTML特殊字符转义\n  func main(inputValue string) string{\n      escapedResult := template.HTMLEscapeString(inputValue)\n      return escapedResult\n  }\n  ```\n\n### 1.2 SQL操作 (重点)\n\n**使用database/sql的prepare、Query或使用GORM等ORM执行SQL操作**\n```go\n  import (\n    \"github.com/jinzhu/gorm\"\n    _ \"github.com/jinzhu/gorm/dialects/sqlite\"\n  )\n  type Product struct {\n    gorm.Model\n    Code string\n    Price uint\n  }\n  ...\n  var product Product\n  db.First(&product, 1)\n```\n**使用参数化查询，禁止拼接SQL语句，另外对于传入参数用于order by或表名的需要通过校验** \n\nSQL注入的风险 当直接拼接 SQL 语句时(bad示例),攻击者可以通过构造特殊的输入来改变 SQL 语句的原意。例如:\n```go\n// 假设攻击者输入的 category 是:\n\"' OR '1'='1\"\n\n// 那么最终的 SQL 语句会变成:\n\"SELECT ITEM,PRICE FROM PRODUCT WHERE ITEM_CATEGORY='' OR '1'='1' ORDER BY PRICE\"\n ```\n\n这样攻击者就能查询到所有商品信息,绕过了 category 的限制。更危险的是,攻击者还可能:\n\n- 删除数据: '; DROP TABLE PRODUCT;--\n- 修改数据: '; UPDATE PRODUCT SET PRICE=0;--\n- 获取数据库结构: ' UNION SELECT table_name,null FROM information_schema.tables;--\n\n使用参数化查询(good示例)时:\n- 参数值会被当作纯文本处理,而不是 SQL 代码的一部分\n- 数据库驱动会自动对特殊字符进行转义\n- SQL 语句的结构是固定的,不会被输入值改变\n\n```go\n// bad\n  import (\n      \"database/sql\"\n      \"fmt\"\n      \"net/http\"\n  )\n  func handler(db *sql.DB, req *http.Request) {\n      q := fmt.Sprintf(\"SELECT ITEM,PRICE FROM PRODUCT WHERE ITEM_CATEGORY='%s' ORDER BY PRICE\",\n          req.URL.Query()[\"category\"])\n      db.Query(q)\n  }\n// good\nfunc handlerGood(db *sql.DB, req *http.Request) {\n    //使用?占位符\n      q := \"SELECT ITEM,PRICE FROM PRODUCT WHERE ITEM_CATEGORY='?' ORDER BY PRICE\"\n      db.Query(q, req.URL.Query()[\"category\"])\n}\n```\n## 1.3网络请求\n\n### 1.3.1资源请求过滤验证\n使用\"net/http\"下的方法http.Get(url)、http.Post(url, contentType, body)、http.Head(url )、http.PostForm(url, data)、http.Do(req)时，如变量值外部可控（指从参数中动态获取），应对请求目标进行严格的安全校验。\n\n如请求资源域名归属固定的范围，如只允许a.qq.com和b.qq.com，应做白名单限制。如不适用白名单，则推荐的校验逻辑步骤是：\n\n- 第 1 步、只允许HTTP或HTTPS协议\n- 第 2 步、解析目标URL，获取其HOST\n- 第 3 步、解析HOST，获取HOST指向的IP地址转换成Long型\n- 第 4 步、检查IP地址是否为内网IP，网段有：\n// 以RFC定义的专有网络为例，如有自定义私有网段亦应加入禁止访问列表。\n10.0.0.0/8\n172.16.0.0/12\n192.168.0.0/16\n127.0.0.0/8\n- 第 5 步、请求URL\n- 第 6 步、如有跳转，跳转后执行1，否则绑定经校验的ip和域名，对URL发起请求\n```go\n  import (\n      \"encoding/xml\"\n      \"fmt\"\n      \"os\"\n  )\n  func main() {\n      type Person struct {\n          XMLName   xml.Name `xml:\"person\"`\n          Id        int      `xml:\"id,attr\"`\n          UserName string   `xml:\"name>first\"`\n          Comment string `xml:\",comment\"`\n      }\n      v := &Person{Id: 13, UserName: \"John\"}\n      v.Comment = \" Need more details. \"\n      enc := xml.NewEncoder(os.Stdout)\n      enc.Indent(\"  \", \"    \")\n      if err := enc.Encode(v); err != nil {\n          fmt.Printf(\"error: %v\\n\", err)\n      }\n  }\n  ```\n  ### 1.4 服务器端渲染\n\n**1.4.1【必须】模板渲染过滤验证**\n\n使用text/template或者html/template渲染模板时禁止将外部输入参数引入模板，或仅允许引入白名单内字符。这个也用不到,大部分都是前后端分离的.\n\n**1.5.1【必须】跨域资源共享CORS限制请求来源**\nCORS请求保护不当可导致敏感信息泄漏，因此应当严格设置Access-Control-Allow-Origin使用同源策略进行保护。防止CSRF攻击.\n**参考这篇美团的文章,《如何防止CSRF攻击?》**\nhttps://tech.meituan.com/2018/10/11/fe-security-csrf.html\n\n```go\n // good\n  c := cors.New(cors.Options{\n      AllowedOrigins: []string{\"http://qq.com\", \"https://qq.com\"},\n      AllowCredentials: true,\n      Debug: false,\n  })\n  //引入中间件\n  handler = c.Handler(handler)\n```\n### 1.6 响应输出\n\n**设置正确的HTTP响应包类型**\n响应头Content-Type与实际响应内容，应保持一致。如：API响应数据类型是json，则响应头使用application/json；若为xml，则设置为text/xml\n\n**添加安全响应头**\n所有接口、页面，添加响应头 X-Content-Type-Options: nosniff。\n所有接口、页面，添加响应头X-Frame-Options。按需合理设置其允许范围，包括：DENY、SAMEORIGIN、ALLOW-FROM origin。\n\n用法参考：MDN文档https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/X-Frame-Options\n\n**外部输入拼接到HTTP响应头中需进行过滤**\n应尽量避免外部可控参数拼接到HTTP响应头中，如业务需要则需要过滤掉\\r、\\n等换行符，或者拒绝携带换行符号的外部输入。\n\n**外部输入拼接到response页面前进行编码处理**\n直出html页面或使用模板生成html页面的，推荐使用text/template自动编码，或者使用html.EscapeString或text/template对\u003C, >, &, ',\"等字符进行编码。\n```go\nimport(\n    \"html/template\"\n)        \nfunc outtemplate(w http.ResponseWriter,r *http.Request) {\n    param1 := r.URL.Query().Get(\"param1\")\n    tmpl := template.New(\"hello\")\n    tmpl, _ = tmpl.Parse(`{{define \"T\"}}{{.}}{{end}}`)\n    tmpl.ExecuteTemplate(w, \"T\", param1)\n}\n```\n### 1.7 会话管理\n\n**安全维护session信息**\n用户登录时应重新生成session，退出登录后应清理session。\n现在用的JWT比较多,作为参考就行.\n```go\n\n#### 1.7.2【必须】CSRF防护\n- 涉及系统敏感操作或可读取敏感信息的接口应校验`Referer`或添加`csrf_token`。\n```go\n// good\nimport (\n    \"net/http\"\n    \"github.com/gorilla/csrf\"\n    \"github.com/gorilla/mux\"\n)\nfunc main() {\n    r := mux.NewRouter()\n    r.HandleFunc(\"/signup\", ShowSignupForm)\n    r.HandleFunc(\"/signup/post\", SubmitSignupForm)\n    //使用csrf_token验证\n    http.ListenAndServe(\":8000\",\n        csrf.Protect([]byte(\"32-byte-long-auth-key\"))(r))\n}\n``` \n\n### 1.8 访问控制\n\n**默认鉴权**\n除非资源完全可对外开放，否则系统默认进行身份认证，使用白名单的方式放开不需要认证的接口或页面。\n\n根据资源的机密程度和用户角色，以最小权限原则，设置不同级别的权限，如完全公开、登录可读、登录可写、特定用户可读、特定用户可写等\n\n涉及用户自身相关的数据的读写必须验证登录态用户身份及其权限，避免越权操作\n\n\n> select id from table where id=:id and userid=session.userid\n\n没有独立账号体系的外网服务使用QQ或微信登录，内网服务使用统一登录服务登录，其他使用账号密码登录的服务需要增加验证码等二次验证\n\n### 1.9 并发保护\n\n**1.9.1【必须】禁止在闭包中直接调用循环变量**\n在循环中启动协程，当协程中使用到了循环的索引值，由于多个协程同时使用同一个变量会产生数据竞争，造成执行结果异常。 这个是要注意的.\n```go\n// bad\nfunc main() {\n    runtime.GOMAXPROCS(runtime.NumCPU())\n    var group sync.WaitGroup\n    for i := 0; i \u003C 5; i++ {\n        group.Add(1)\n        go func() {\n            defer group.Done()\n            fmt.Printf(\"%-2d\", i) //这里打印的i不是所期望的\n        }()\n    }\n    group.Wait()\n}\n// good\nfunc main() {\n    runtime.GOMAXPROCS(runtime.NumCPU())\n    var group sync.WaitGroup\n    for i := 0; i \u003C 5; i++ {\n        group.Add(1)\n        go func(j int) {\n            defer func() {\n                if r := recover(); r != nil {\n                    fmt.Println(\"Recovered in start()\")\n                }\n                group.Done()\n            }()\n        fmt.Printf(\"%-2d\", j) // 闭包内部使用局部变量\n        }(i)  // 把循环变量显式地传给协程\n    }\n    group.Wait()\n}\n\n**1.9.2【必须】禁止并发写map**\n并发写map容易造成程序崩溃并异常退出，建议加锁保护.\n```go\n// bad\nfunc main() {\n  m := make(map[int]int)\n  //并发读写\n  go func() {\n      for {\n          _ = m[1] \n      }\n  }()\n  go func() {\n      for {\n          m[2] = 1\n      }\n  }()\n  select {}\n}\n```\n\n**1.9.3【必须】确保并发安全**\n\n敏感操作如果未作并发安全限制，可导致数据读写异常，造成业务逻辑限制被绕过。可通过同步锁或者原子操作进行防护。\n\nPS 原子操作只能操作单个变量,不能控制区间代码的逻辑,锁可以,当需要操作多个变量或复杂逻辑时,需要使用互斥锁.\n\n通过同步锁共享内存\n```go\n// good\nvar count int\nfunc Count(lock *sync.Mutex) {\n    lock.Lock()// 加写锁\n    count++\n    fmt.Println(count)\n    lock.Unlock()// 解写锁，任何一个Lock()或RLock()均需要保证对应有Unlock()或RUnlock()\n}\nfunc main() {\n    lock := &sync.Mutex{}\n    for i := 0; i \u003C 10; i++ {\n        go Count(lock) //传递指针是为了防止函数内的锁和调用锁不一致\n    }\n    for {\n        lock.Lock()\n        c := count\n        lock.Unlock()\n        runtime.Gosched()//交出时间片给协程\n        if c > 10 {\n            break\n        }\n    }\n}\n```\n\n使用sync/atomic执行原子操作\n```go\n// good\nimport (\n    \"sync\"\n    \"sync/atomic\"\n)\nfunc main() {\n    type Map map[string]string\n    var m atomic.Value\n    m.Store(make(Map))\n    var mu sync.Mutex // used only by writers\n    read := func(key string) (val string) {\n        m1 := m.Load().(Map)\n        return m1[key]\n    }\n    insert := func(key, val string) {\n        mu.Lock() // 与潜在写入同步\n        defer mu.Unlock()\n        m1 := m.Load().(Map) // 导入struct当前数据\n        m2 := make(Map)      // 创建新值\n        for k, v := range m1 {\n            m2[k] = v\n        }\n        m2[key] = val\n        m.Store(m2)   // 用新的替代当前对象\n    }\n    _, _ = read, insert\n}\n```","src/content/blog/代码安全指南.md","d06740a3d1099159",{"html":23,"metadata":24},"\u003Cp>腾讯代码安全指南,原文链接 \u003Ca href=\"https://github.com/Tencent/secguide\">https://github.com/Tencent/secguide\u003C/a>.\u003C/p>\n\u003Cp>\u003Cstrong>(小声bb:看原文不如看我的,我的 =  腾讯代码安全指南Plus版本)\u003C/strong>\u003C/p>\n\u003Ch3 id=\"通用类\">通用类\u003C/h3>\n\u003Ch3 id=\"11内存管理\">1.1内存管理\u003C/h3>\n\u003Cp>\u003Cstrong>1.1.1 切片长度校验\u003C/strong>\u003C/p>\n\u003Cp>目的:防止访问到超出切片容量的索引,导致panic.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"background-color:#ffffff;--shiki-dark-bg:#011627;color:#24292eff;--shiki-dark:#d6deeb; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"go\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// bad: 未判断data的长度，可导致 index out of range,访问越界.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 在函数 decode 中，没有检查输入数据的长度，直接访问索引，可能导致 index out of range 错误。\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> decode\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">data\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> []\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">byte\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">bool\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">\tif\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> data\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">0\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">] \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">==\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\"> '\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#82AAFF\">F\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">'\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> &#x26;&#x26;\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> data\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">1\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">] \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">==\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\"> '\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#82AAFF\">U\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">'\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> &#x26;&#x26;\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> data\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">2\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">] \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">==\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\"> '\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#82AAFF\">Z\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">'\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> &#x26;&#x26;\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> data\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">3\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">] \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">==\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\"> '\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#82AAFF\">Z\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">'\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> &#x26;&#x26;\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> data\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">4\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">] \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">==\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\"> '\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#82AAFF\">E\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">'\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> &#x26;&#x26;\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> data\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">5\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">] \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">==\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\"> '\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#82AAFF\">R\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">'\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">\t\tfmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Println\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">Bad\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">\t\treturn\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> true\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">\t}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">\treturn\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> false\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// bad: slice bounds out of range\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 在函数 foo 中，尝试访问切片超出范围的部分，导致 slice bounds out of range 错误\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> foo\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">() {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">\tvar\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> slice\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> []\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">int\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">{\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">0\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">1\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">2\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">3\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">4\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">5\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">6\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">\tfmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Println\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">slice\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">[:\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">10\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">])\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// good: 使用data前应判断长度是否合法\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> decode\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">data\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> []\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">byte\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">bool\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">\tif\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> len\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">data\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">==\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\"> 6\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">\t\tif\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> data\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">0\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">] \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">==\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\"> '\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#82AAFF\">F\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">'\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> &#x26;&#x26;\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> data\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">1\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">] \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">==\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\"> '\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#82AAFF\">U\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">'\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> &#x26;&#x26;\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> data\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">2\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">] \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">==\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\"> '\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#82AAFF\">Z\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">'\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> &#x26;&#x26;\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> data\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">3\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">] \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">==\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\"> '\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#82AAFF\">Z\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">'\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> &#x26;&#x26;\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> data\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">4\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">] \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">==\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\"> '\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#82AAFF\">E\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">'\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> &#x26;&#x26;\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> data\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">5\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">] \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">==\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\"> '\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#82AAFF\">R\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">'\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">\t\t\tfmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Println\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">Good\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">\t\t\treturn\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> true\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">\t\t}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">\t}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">\treturn\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> false\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>\u003Cstrong>1.1.2\u003C/strong> nil指针判断\u003C/p>\n\u003Cp>进行指针操作时,必须要对指针进行空指针判断,防止panic(go对空指针进行解引用,会panic,c语言则是segmentation fault).\u003C/p>\n\u003Cp>在访问 packet.Data 之前，先判断它是否 nil,如果 Data 为空，就不会继续访问其字段，从而避免 panic,尤其是结构体Unmarshal.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"background-color:#ffffff;--shiki-dark-bg:#011627;color:#24292eff;--shiki-dark:#d6deeb; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"go\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">type\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\"> Packet\u003C/span>\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> struct\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">    PackeyType\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">        uint8\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">    PackeyVersion\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">     uint8\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">    Data\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\">              *\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">Data\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">type\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\"> Data\u003C/span>\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> struct\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">    Stat\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">    uint8\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">    Len\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">     uint8\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">    Buf\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">     [\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">8\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">]\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">byte\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">p \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\">*\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">Packet\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">UnmarshalBinary\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">b\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> []\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">byte\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">error\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> len\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">b\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">&#x3C;\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\"> 2\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">       return\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> io\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">EOF\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    p\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">PackeyType\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> b\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">0\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    p\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">PackeyVersion\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> b\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">1\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 若长度等于2，那么不会new Data\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> len\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">b\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">>\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\"> 2\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        p\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">Data\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> new\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">Data\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">        // Unmarshal(b[i:], p.Data)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> nil\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// bad: 未判断指针是否为nil\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> main\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">() {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    packet\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> new\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">Packet\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    data\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> make\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">([]\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">byte\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">2\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> packet\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">UnmarshalBinary\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">data\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">); \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> !=\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> nil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        fmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Println\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">Failed to unmarshal packet\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    fmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Printf\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">Stat: \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">%v\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#F78C6C\">\\n\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">packet\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">Data\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">Stat\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// good: 判断Data指针是否未nil\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> main\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">() {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    packet\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> new\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">Packet\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    data\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> make\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">([]\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">byte\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">2\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> packet\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">UnmarshalBinary\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">data\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">); \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> !=\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> nil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        fmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Println\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">Failed to unmarshal packet\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> packet\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">Data\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> ==\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> nil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    fmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Printf\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">Stat: \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">%v\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#F78C6C\">\\n\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">packet\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">Data\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">Stat\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>\u003Cstrong>1.1.3 整数安全\u003C/strong>\n因为数是有边界的int32(65536),int64的长度都是不一样的.\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>在进行数字运算操作时，需要做好长度限制，防止外部输入运算导致异常:\u003C/strong>\u003C/li>\n\u003Cli>确保无符号整数运算时不会反转\u003C/li>\n\u003Cli>确保有符号整数运算时不会出现溢出\u003C/li>\n\u003Cli>确保整型转换时不会出现截断错误\u003C/li>\n\u003Cli>确保整型转换时不会出现符号错误\u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cstrong>以下场景必须严格进行长度限制\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>作为数组索引\u003C/li>\n\u003Cli>作为对象的长度或者大小\u003C/li>\n\u003Cli>作为数组的边界（如作为循环计数器）\u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cstrong>1.1.4 make分配长度验证\u003C/strong>\u003C/p>\n\u003Cp>在进行make分配内存时，需要对外部可控的长度进行校验，防止程序panic。\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"background-color:#ffffff;--shiki-dark-bg:#011627;color:#24292eff;--shiki-dark:#d6deeb; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"go\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// bad\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> parse\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">lenControlByUser\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> int\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">data\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">[] \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">byte\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    size\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> lenControlByUser\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    //对外部传入的size，进行长度判断以免导致panic\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    buffer\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> make\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">([]\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">byte\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">size\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">    copy\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">buffer\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">data\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// good\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> parse\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">lenControlByUser\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> int\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">data\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">[] \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">byte\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) ([]\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">byte\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">error\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">){\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    size\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> lenControlByUser\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    //限制外部可控的长度大小范围\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> size\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> >\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\"> 64\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">*\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">1024\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">*\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">1024\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> nil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">errors\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">New\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">value too large\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    buffer\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> make\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">([]\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">byte\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">size\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">    copy\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">buffer\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">data\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> buffer\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">nil\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>\u003Cstrong>1.1.5 禁止SetFinalizer和指针循环引用同时使用\u003C/strong>\u003C/p>\n\u003Cp>这个其实用到的地方不多,尽量不要产生循环引用.\u003C/p>\n\u003Cp>当一个对象从被GC选中到移除内存之前，runtime.SetFinalizer()都不会执行，即使程序正常结束或者发生错误。由指针构成的“循环引用”虽然能被GC正确处理，但由于无法确定Finalizer依赖顺序，从而无法调用runtime.SetFinalizer()，导致目标对象无法变成可达状态，从而造成内存无法被回收。\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"background-color:#ffffff;--shiki-dark-bg:#011627;color:#24292eff;--shiki-dark:#d6deeb; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"go\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// bad\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> foo\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">() {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    var\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> a\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">b\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\"> Data\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    a\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">o\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">b\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    b\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">o\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">a\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    //指针循环引用，SetFinalizer()无法正常调用\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    runtime\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">SetFinalizer\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">a\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">d\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">Data\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        fmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Printf\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">a \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">%p\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\"> final.\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#F78C6C\">\\n\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">d\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    })\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    runtime\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">SetFinalizer\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">b\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">d\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">Data\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        fmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Printf\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">b \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">%p\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\"> final.\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#F78C6C\">\\n\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">d\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    })\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> main\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">() {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    for\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">        foo\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        time\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Sleep\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">time\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">Millisecond\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>\u003Cstrong>1.1.6 禁止重复释放channel\u003C/strong>\u003C/p>\n\u003Cp>重复释放一般存在于异常流程判断中，如果恶意攻击者构造出异常条件使程序重复释放channel，则会触发运行时恐慌，从而造成DoS攻击。\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"background-color:#ffffff;--shiki-dark-bg:#011627;color:#24292eff;--shiki-dark:#d6deeb; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"go\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// bad\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> foo\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">c\u003C/span>\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> chan\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> int\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    defer\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> close\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">c\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> processBusiness\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> !=\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> nil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        c\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\"> &#x3C;-\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\"> 0\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">        close\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">c\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 重复释放channel\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    c\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\"> &#x3C;-\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\"> 1\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// good\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> foo\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">c\u003C/span>\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> chan\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> int\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    defer\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> close\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">c\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 使用defer延迟关闭channel\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> processBusiness\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> !=\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> nil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        c\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\"> &#x3C;-\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\"> 0\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    c\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\"> &#x3C;-\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\"> 1\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>\u003Cstrong>1.1.7 确保每个go routine都能退出\u003C/strong>\u003C/p>\n\u003Cp>启动一个协程就会做一个入栈操作，在系统不退出的情况下，协程也没有设置退出条件，则相当于协程失去了控制，它占用的资源无法回收，可能会导致内存泄露.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"background-color:#ffffff;--shiki-dark-bg:#011627;color:#24292eff;--shiki-dark:#d6deeb; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"go\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// bad: 协程没有设置退出条件\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> doWaiter\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">name\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> string\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">second\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> int\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    for\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        time\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Sleep\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">time\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Duration\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">second\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">*\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> time\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">Second\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        fmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Println\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">name\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\"> is ready!\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// good: 使用信号通道控制协程退出\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> doWaiter\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">name\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> string\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">second\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> int\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">quit\u003C/span>\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> chan\u003C/span>\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> struct\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">{}) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    for\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        select\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        case\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\"> &#x3C;-\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">quit\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">            fmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Println\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">name\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\"> is exiting!\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">            return\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        default\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">            time\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Sleep\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">time\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Duration\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">second\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">*\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> time\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">Second\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">            fmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Println\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">name\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\"> is ready!\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>\u003Cstrong>1.1.8 不使用unsafe包\u003C/strong>\u003C/p>\n\u003Cp>由于unsafe包绕过了 Golang 的内存安全原则，一般来说使用该库是不安全的，可导致内存破坏，尽量避免使用该包。若必须要使用unsafe操作指针，必须做好安全校验。\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"background-color:#ffffff;--shiki-dark-bg:#011627;color:#24292eff;--shiki-dark:#d6deeb; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"go\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// bad: 通过unsafe操作原始指针\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> unsafePointer\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">() {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    b\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> make\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">([]\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">byte\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">1\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    foo\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\">*\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">int\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">unsafe\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Pointer\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">uintptr\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">unsafe\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Pointer\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">b\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">0\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">])) \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">+\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> uintptr\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#FFEB95\">0x\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">fffffffe\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)))\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    fmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Print\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\">*\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">foo\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> +\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\"> 1\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// [signal SIGSEGV: segmentation violation code=0x1 addr=0xc100068f55 pc=0x49142b]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>\u003Cstrong>1.1.9 不使用slice作为函数入参 (不太赞同)\u003C/strong>\u003C/p>\n\u003Cblockquote>\n\u003Cp>slice是引用类型，在作为函数入参时采用的是地址传递，对slice的修改也会影响原始数据.\u003C/p>\n\u003C/blockquote>\n\u003Cp>\u003Cstrong>但是\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>传递 slice 不会复制底层数组，适合处理大数据集，避免不必要的内存开销。\u003C/li>\n\u003Cli>slice 可以方便地传递部分数据，适合需要操作子集的情况。\u003C/li>\n\u003Cli>如果函数需要修改 slice 的元素，直接传递 slice 是合适的，因为 slice 是引用类型，修改会反映在原 slice 上。 我觉得这是优点.\u003C/li>\n\u003C/ul>\n\u003Cp>如果希望函数不修改原 slice，可以传递 slice 的副本或使用只读数据结构。\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"background-color:#ffffff;--shiki-dark-bg:#011627;color:#24292eff;--shiki-dark:#d6deeb; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"go\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> ownSlice\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">s\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> []\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">int\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) []\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">int\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    newSlice\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> make\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">([]\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">int\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">len\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">s\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">))\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">    copy\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">newSlice\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">s\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> newSlice\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"12文件操作\">1.2文件操作\u003C/h3>\n\u003Cp>\u003Cstrong>1.2.1  路径穿越检查\u003C/strong>\u003C/p>\n\u003Cp>在进行文件操作时，如果对外部传入的文件名未做限制，可能导致任意文件读取或者任意文件写入，严重可能导致代码执行。\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"background-color:#ffffff;--shiki-dark-bg:#011627;color:#24292eff;--shiki-dark:#d6deeb; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"go\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// bad: 任意文件读取\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> handler\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">w\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\"> http\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">ResponseWriter\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">r\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">http\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">Request\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    //类型1\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    path\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> r\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">URL\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Query\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">()[\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">path\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">][\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">0\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 未过滤文件路径，可能导致任意文件读取\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    data\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">_\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> ioutil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">ReadFile\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">path\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    w\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Write\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">data\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 攻击者可以通过构造特殊的 URL 参数来读取系统中的任意文件，例如：\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // http://example.com/handler?path=/etc/passwd\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // http://example.com/handler?path=../../etc/shadow\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    //类型2\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 对外部传入的文件名变量，还需要验证是否存在../等路径穿越的文件名\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 虽然使用了 filepath.Join ，但仍然可以通过 ../ 进行目录遍历，\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    data\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">_\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> ioutil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">ReadFile\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">filepath\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Join\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">/home/user/\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">path\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">))\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    w\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Write\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">data\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // http://example.com/handler?path=../../../etc/passwd\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    /*--------------------------分割线-------------------------*/\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 攻击者的请求示例\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    req\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">_\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> http\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">NewRequest\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">GET\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">http://example.com/handler?path=/etc/passwd\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">nil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 或者使用相对路径\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    req\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">_\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> http\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">NewRequest\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">GET\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">http://example.com/handler?path=../../../../etc/passwd\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">nil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> // 安全实现\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> safeHandler\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">w\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\"> http\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">ResponseWriter\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">r\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">http\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">Request\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 1. 获取并验证路径参数\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    paths\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">ok\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> r\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">URL\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Query\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">()[\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">path\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> !\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">ok\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> ||\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> len\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">paths\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">==\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\"> 0\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        http\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Error\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">w\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">missing path parameter\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">http\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">StatusBadRequest\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    userPath\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> paths\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">0\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 2. 定义允许访问的根目录\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    baseDir\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">/home/user/safe_files\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 3. 清理和规范化路径\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    cleanPath\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> filepath\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Clean\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">userPath\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 4. 构建完整的文件路径\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    fullPath\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> filepath\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Join\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">baseDir\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">cleanPath\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 5. 验证最终路径是否在允许的目录内\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> !\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">strings\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">HasPrefix\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">fullPath\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">baseDir\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        http\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Error\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">w\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">access denied\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">http\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">StatusForbidden\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 6. 验证文件是否存在\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> _\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> os\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Stat\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">fullPath\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">); \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">os\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">IsNotExist\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        http\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Error\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">w\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">file not found\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">http\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">StatusNotFound\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 7. 安全地读取文件\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    data\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> ioutil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">ReadFile\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">fullPath\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> !=\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> nil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        http\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Error\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">w\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">failed to read file\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">http\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">StatusInternalServerError\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    w\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Write\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">data\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>任意文件写入案例\u003C/p>\n\u003Cul>\n\u003Cli>代码直接使用压缩文件中的文件名（ f.Name ）\u003C/li>\n\u003Cli>攻击者可以构造包含 ../ 的文件名\u003C/li>\n\u003Cli>即使使用了 filepath.Abs ，仍然无法防止路径穿越\u003C/li>\n\u003C/ul>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"background-color:#ffffff;--shiki-dark-bg:#011627;color:#24292eff;--shiki-dark:#d6deeb; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"go\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// bad: 任意文件写入\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> unzip\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">f\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> string\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    r\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">_\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> zip\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">OpenReader\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">f\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    for\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> _\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">f\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> range\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> r\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">File\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        p\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">_\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> filepath\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Abs\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">f\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">Name\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">        // 未验证压缩文件名，可能导致../等路径穿越，任意文件路径写入\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        ioutil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">WriteFile\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">p\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, []\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">byte\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">present\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">), \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">0640\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">//////////////////分割线////////////////////\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> createEvilZip\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">() \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">error\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 创建恶意 ZIP 文件\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    zipfile\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> os\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Create\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">evil.zip\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> !=\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> nil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> err\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    defer\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> zipfile\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Close\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 创建 ZIP writer\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    zipWriter\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> zip\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">NewWriter\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">zipfile\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    defer\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> zipWriter\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Close\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 创建恶意文件路径\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    evilPaths\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> []\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">string\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">        \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">../../../etc/passwd\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">,                 \u003C/span>\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// Unix 系统敏感文件\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">        \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">..\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#F78C6C\">\\\\\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">..\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#F78C6C\">\\\\\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">..\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#F78C6C\">\\\\\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">windows\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#F78C6C\">\\\\\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">system.ini\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">,    \u003C/span>\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// Windows 系统文件\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">        \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">../../../root/.ssh/authorized_keys\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">,  \u003C/span>\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// SSH 密钥\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 将恶意路径添加到 ZIP 文件中\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    for\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> _\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">path\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> range\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> evilPaths\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        _\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> zipWriter\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Create\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">path\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        if\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> !=\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> nil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">            return\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> err\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> nil\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">//////////////////分割线////////////////////\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">/*\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">当这个恶意 ZIP 文件被不安全的解压程序处理时，会尝试写入到这些敏感路径。这就是为什么在解压 ZIP 文件时必须：\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">1. 验证最终路径是否在允许的目录内\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">2. 检查路径中是否包含 ../ 或 ..\\\\ 等穿越字符\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">3. 使用安全的解压函数（如前面提到的 safeUnzip ）\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">*/\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// good: 检查压缩的文件名是否包含..路径穿越特征字符，防止任意写入\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> unzipGood\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">f\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> string\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">bool\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    r\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> zip\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">OpenReader\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">f\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> !=\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> nil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        fmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Println\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">read zip file fail\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> false\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    for\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> _\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">f\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> range\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> r\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">File\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        p\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">_\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> filepath\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Abs\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">f\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">Name\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        if\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> !\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">strings\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Contains\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">p\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">..\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">            ioutil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">WriteFile\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">p\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, []\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">byte\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">present\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">), \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">0640\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> true\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 完整的解压函数案例:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> secureUnzip\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">zipFile\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">destDir\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> string\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">error\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 1. 规范化目标目录路径\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    absDestDir\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> filepath\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Abs\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">destDir\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> !=\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> nil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> fmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Errorf\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">invalid destination path: \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">%v\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 2. 打开并验证 ZIP 文件\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    reader\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> zip\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">OpenReader\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">zipFile\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> !=\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> nil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> fmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Errorf\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">failed to open zip: \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">%v\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    defer\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> reader\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Close\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 3. 遍历处理所有文件\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    for\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> _\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">file\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> range\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> reader\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">File\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">        // 4. 安全检查\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        if\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> validateZipFile\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">file\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">absDestDir\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">); \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> !=\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> nil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">            return\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> fmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Errorf\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">security check failed: \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">%v\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">        // 5. 处理文件\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        if\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> extractFile\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">file\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">absDestDir\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">); \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> !=\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> nil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">            return\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> fmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Errorf\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">extraction failed: \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">%v\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> nil\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> validateZipFile\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">file\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">zip\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">File\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">destDir\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> string\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">error\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 1. 路径规范化\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    destPath\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> filepath\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Join\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">destDir\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">file\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">Name\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    destPath\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> filepath\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Clean\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">destPath\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 2. 路径穿越检查\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> !\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">strings\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">HasPrefix\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">destPath\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">destDir\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> fmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Errorf\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">path traversal attempt detected: \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">%s\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">file\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">Name\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 3. 文件大小检查\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> file\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">UncompressedSize64\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> >\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\"> 100\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">*\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">1024\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">*\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">1024\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> { \u003C/span>\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 100MB 限制\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> fmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Errorf\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">file too large: \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">%s\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">file\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">Name\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 4. 文件权限检查\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> file\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Mode\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">os\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">ModeSymlink\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> !=\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\"> 0\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> fmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Errorf\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">symlinks not allowed: \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">%s\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">file\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">Name\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 5. 文件名合法性检查\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> strings\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Contains\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">file\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">Name\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">..\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">||\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> strings\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Contains\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">file\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">Name\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">//\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> fmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Errorf\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">invalid file path: \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">%s\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">file\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">Name\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> nil\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> extractFile\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">file\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">zip\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">File\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">destDir\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> string\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">error\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 1. 构建目标路径\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    destPath\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> filepath\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Join\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">destDir\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">file\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">Name\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 2. 创建必要的目录\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> os\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">MkdirAll\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">filepath\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Dir\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">destPath\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">), \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">0755\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">); \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> !=\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> nil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> err\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 3. 创建目标文件\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    destFile\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> os\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">OpenFile\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">destPath\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">os\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">O_WRONLY\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">os\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">O_CREATE\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">|\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">os\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">O_TRUNC\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">file\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Mode\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">())\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> !=\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> nil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> err\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    defer\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> destFile\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Close\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 4. 打开源文件\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    srcFile\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> file\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Open\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> !=\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> nil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> err\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    defer\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> srcFile\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Close\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 5. 限制读取速度和大小\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    limitedReader\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">io\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">LimitedReader\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">        R\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">: \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">srcFile\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">        N\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">: \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">100\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> *\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\"> 1024\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> *\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\"> 1024\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 100MB 限制\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 6. 复制文件内容\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    _\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> io\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Copy\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">destFile\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">limitedReader\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> err\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">/*\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">安全措施：\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">1. 完整的路径验证\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">2. 文件大小限制\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">3. 符号链接检查\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">4. 文件名合法性验证\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">5. 资源使用限制\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">6. 错误处理和资源清理\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">7. 权限控制\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">这样的实现能够有效防止各种攻击，包括：\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">- 路径穿越\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">- 拒绝服务（通过大文件）\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">- 符号链接攻击\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">- 资源耗尽攻击\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">*/\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>\u003Cstrong>1.2.1 文件访问权限\u003C/strong>\n根据创建文件的敏感性设置不同级别的访问权限，以防止敏感数据被任意权限用户读取。例如，设置文件权限为：-rw-r-----\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"background-color:#ffffff;--shiki-dark-bg:#011627;color:#24292eff;--shiki-dark:#d6deeb; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"go\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">ioutil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">WriteFile\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">p\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, []\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">byte\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">present\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">), \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">0640\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 创建一个普通文件，所有人都可以读\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> ioutil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">WriteFile\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">public.txt\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, []\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">byte\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">Hello\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">), \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">0644\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 创建一个敏感配置文件，只有所有者可以读写\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> ioutil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">WriteFile\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">config.json\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, []\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">byte\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">secret\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">), \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">0600\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 创建一个组内共享文件，组内成员可读\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> ioutil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">WriteFile\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">group_share.txt\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, []\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">byte\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">group data\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">), \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">0640\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"13-系统接口\">1.3 系统接口\u003C/h3>\n\u003Cp>1.3.1【必须】命令执行检查\u003C/p>\n\u003Cblockquote>\n\u003Cp>使用exec.Command、exec.CommandContext、syscall.StartProcess、os.StartProcess等函数时，第一个参数（path）直接取外部输入值时，应使用白名单限定可执行的命令范围，不允许传入bash、cmd、sh等命令；\u003C/p>\n\u003C/blockquote>\n\u003Cblockquote>\n\u003Cp>使用exec.Command、exec.CommandContext等函数时，通过bash、cmd、sh等创建shell，-c后的参数（arg）拼接外部输入，应过滤\\n $ &#x26; ; | ‘ “ ( ) `等潜在恶意字符；\u003C/p>\n\u003C/blockquote>\n\u003Cp>主要安全措施\u003C/p>\n\u003Col>\n\u003Cli>命令白名单 ：\n\u003Cul>\n\u003Cli>明确定义允许执行的命令\u003C/li>\n\u003Cli>拒绝执行未知命令\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003Cli>危险字符过滤 ：\n\u003Cul>\n\u003Cli>过滤可能导致命令注入的字符\u003C/li>\n\u003Cli>包括 `\\n $ &#x26; ; | ’ ” ( ) “ 等\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003Cli>参数化处理 ：\n\u003Cul>\n\u003Cli>避免字符串拼接\u003C/li>\n\u003Cli>使用命令参数方式传递值\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003Cli>超时控制 ：\n\u003Cul>\n\u003Cli>使用 Context 控制执行时间\u003C/li>\n\u003Cli>防止命令执行时间过长\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003Cli>错误处理 ：\n\u003Cul>\n\u003Cli>详细的错误信息\u003C/li>\n\u003Cli>合适的错误返回\n这样的实现可以有效防止：\n\u003Cul>\n\u003Cli>命令注入攻击\u003C/li>\n\u003Cli>恶意命令执行\u003C/li>\n\u003Cli>资源耗尽攻击\u003C/li>\n\u003Cli>拒绝服务攻击\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003C/ol>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"background-color:#ffffff;--shiki-dark-bg:#011627;color:#24292eff;--shiki-dark:#d6deeb; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"go\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 不安全的命令执行示例\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> unsafeExec\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">command\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> string\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">error\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 直接使用外部输入作为命令，非常危险\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    cmd\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> exec\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Command\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">command\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)  \u003C/span>\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 危险：直接使用外部输入\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> cmd\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Run\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> unsafeShellExec\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">argument\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> string\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">error\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 通过 shell 执行命令，并拼接外部输入，非常危险\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    cmd\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> exec\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Command\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">bash\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">-c\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">echo \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> +\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> argument\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)  \u003C/span>\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 危险：直接拼接外部输入\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> cmd\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Run\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 安全的命令执行实现\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> safeExec\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">command\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> string\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">error\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 定义允许执行的命令白名单\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    allowedCommands\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> map\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">string\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">]\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">bool\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">        \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">git\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">:    \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">true\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">        \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">ls\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">:     \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">true\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">        \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">whoami\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">: \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">true\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 检查命令是否在白名单中\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> !\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">allowedCommands\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">command\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">] {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> fmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Errorf\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">command not allowed: \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">%s\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">command\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    cmd\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> exec\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Command\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">command\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> cmd\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Run\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 安全的 shell 命令执行\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> safeShellExec\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">argument\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> string\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">error\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 定义不允许的字符\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    dangerousChars\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> []\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">string\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">        \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#F78C6C\">\\n\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">$\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">&#x26;\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">;\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">|\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">'\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#F78C6C\">\\\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">)\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">`\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 检查是否包含危险字符\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    for\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> _\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">char\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> range\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> dangerousChars\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        if\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> strings\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Contains\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">argument\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">char\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">            return\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> fmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Errorf\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">dangerous character found in argument: \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">%s\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">char\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 使用参数化方式执行命令\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    cmd\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> exec\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Command\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">echo\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">argument\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)  \u003C/span>\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 安全：作为参数传入\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> cmd\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Run\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 使用 Context 控制命令执行超时\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> safeExecWithTimeout\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">command\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> string\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">error\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 创建带超时的 context\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    ctx\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">cancel\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> context\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">WithTimeout\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">context\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Background\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(), \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">5\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\">*\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">time\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">Second\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    defer\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> cancel\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 检查命令白名单\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    allowedCommands\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> map\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">string\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">]\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">bool\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">        \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">git\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">: \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">true\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">        \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">ls\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">:  \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">true\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> !\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">allowedCommands\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">command\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">] {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> fmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Errorf\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">command not allowed: \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">%s\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">command\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 使用 CommandContext 执行命令\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    cmd\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> exec\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">CommandContext\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">ctx\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">command\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> cmd\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Run\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"14-通信安全\">1.4 通信安全\u003C/h3>\n\u003Cp>\u003Cstrong>1.4.1 网络通信采用TLS方式\u003C/strong>\u003C/p>\n\u003Cp>明文传输的通信协议目前已被验证存在较大安全风险，被中间人劫持后可能导致许多安全风险，因此必须采用至少TLS的安全通信方式保证通信安全，例如gRPC/Websocket都使用TLS1.3。\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"background-color:#ffffff;--shiki-dark-bg:#011627;color:#24292eff;--shiki-dark:#d6deeb; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"go\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// good\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> main\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">() {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">  http\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">HandleFunc\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">/\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">w\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> http\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">ResponseWriter\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">req\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">http\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">Request\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    w\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Header\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">().\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Add\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">Strict-Transport-Security\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">max-age=63072000; includeSubDomains\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    w\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Write\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">([]\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">byte\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">This is an example server.\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#F78C6C\">\\n\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">))\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">  })\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  //服务器配置证书与私钥\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">  log\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Fatal\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">http\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">ListenAndServeTLS\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">:443\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">yourCert.pem\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">yourKey.pem\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">nil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">))\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>\u003Cstrong>1.4.2 TLS启用证书验证\u003C/strong>\u003C/p>\n\u003Cp>TLS证书应当是有效的、未过期的，且配置正确的域名，生产环境的服务端应启用证书验证。\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"background-color:#ffffff;--shiki-dark-bg:#011627;color:#24292eff;--shiki-dark:#d6deeb; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"go\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// bad\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">    \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">crypto/tls\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">    \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">net/http\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> doAuthReq\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">authReq\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">http\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">Request\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\">*\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">http\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">Response\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    tr\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">http\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">Transport\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">        TLSClientConfig\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">: \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">tls\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">Config\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">{\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">InsecureSkipVerify\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">: \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">true\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">},\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">        //InsecureSkipVerify: true 完全禁用证书验证\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    client\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">http\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">Client\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">{\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">Transport\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">: \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">tr\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    res\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">_\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> client\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Do\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">authReq\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> res\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// good\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">    \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">crypto/tls\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">    \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">net/http\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> doAuthReq\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">authReq\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">http\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">Request\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\">*\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">http\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">Response\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    tr\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">http\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">Transport\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">        TLSClientConfig\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">: \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">tls\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">Config\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">{\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">InsecureSkipVerify\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">: \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">false\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">},\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    client\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">http\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">Client\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">{\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">Transport\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">: \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">tr\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    res\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">_\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> client\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Do\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">authReq\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> res\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">} \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"15-敏感数据保护\">1.5 敏感数据保护\u003C/h3>\n\u003Cp>\u003Cstrong>1.5.1【必须】敏感信息访问\u003C/strong>\u003C/p>\n\u003Cp>禁止将敏感信息硬编码在程序中，既可能会将敏感信息暴露给攻击者，也会增加代码管理和维护的难度\n使用配置中心系统统一托管密钥等敏感信息\u003C/p>\n\u003Cp>\u003Cstrong>1.5.2【必须】敏感数据输出\u003C/strong>\u003C/p>\n\u003Cp>只输出必要的最小数据集，避免多余字段暴露引起敏感信息泄露\n不能在日志保存密码（包括明文密码和密文密码）、密钥和其它敏感信息\n对于必须输出的敏感信息，必须进行合理脱敏展示\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"background-color:#ffffff;--shiki-dark-bg:#011627;color:#24292eff;--shiki-dark:#d6deeb; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"go\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// bad\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> serve\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">() {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    http\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">HandleFunc\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">/register\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">w\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\"> http\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">ResponseWriter\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">r\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">http\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">Request\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        r\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">ParseForm\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        user\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> r\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">Form\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Get\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">user\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        pw\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> r\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">Form\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Get\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">password\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        log\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Printf\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">Registering new user \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">%s\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\"> with password \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">%s\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">.\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#F78C6C\">\\n\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">user\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">pw\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    })\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    http\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">ListenAndServe\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">:80\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">nil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// good\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> serve1\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">() {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    http\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">HandleFunc\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">/register\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">w\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\"> http\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">ResponseWriter\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">r\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">http\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">Request\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        r\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">ParseForm\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        user\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> r\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">Form\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Get\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">user\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        pw\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> r\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">Form\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Get\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">password\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        log\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Printf\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">Registering new user \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">%s\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">.\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#F78C6C\">\\n\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">user\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">        // ...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">        use\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">pw\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    })\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    http\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">ListenAndServe\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">:80\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">nil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>\u003Cstrong>1.5.3【必须】敏感数据存储\u003C/strong>\u003C/p>\n\u003Cp>敏感数据应使用SHA2、RSA等算法进行加密存储\n敏感数据应使用独立的存储层，并在访问层开启访问控制\n包含敏感信息的临时文件或缓存一旦不再需要应立刻删除\u003C/p>\n\u003Cp>\u003Cstrong>1.5.4【必须】异常处理和日志记录\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>应合理使用panic、recover、defer处理系统异常，避免出错信息输出到前端\u003C/li>\n\u003C/ul>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"background-color:#ffffff;--shiki-dark-bg:#011627;color:#24292eff;--shiki-dark:#d6deeb; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"go\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">defer\u003C/span>\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> func\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> () {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        if\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> r\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> recover\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(); \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">r\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> !=\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> nil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">            fmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Println\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">Recovered in start()\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cul>\n\u003Cli>对外环境禁止开启debug模式，或将程序运行日志输出到前端.\n这点很重要,我之前实习所在的公司就曾经将debug模式的代码包发成正式包 = =.\u003C/li>\n\u003C/ul>\n\u003Ch3 id=\"16加密解密\">1.6加密解密\u003C/h3>\n\u003Cp>\u003Cstrong>1.6.1【必须】不得硬编码密码/密钥 常识\u003C/strong>\u003C/p>\n\u003Cp>在进行用户登陆，加解密算法等操作时，不得在代码里硬编码密钥或密码，可通过变换算法或者配置等方式设置密码或者密钥。前后端加密算法保持一致即可.记得我实习的时候,写过一个夭折的产品,前后端算法加密类型不一致,挺搞笑的,我下意识默认用sha256了,调试的时候就很懵逼,沟通很重要的.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"background-color:#ffffff;--shiki-dark-bg:#011627;color:#24292eff;--shiki-dark:#d6deeb; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"go\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// bad\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">const\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#1976D2;--shiki-dark:#82AAFF\">    user\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">     =\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">dbuser\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#1976D2;--shiki-dark:#82AAFF\">    password\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">s3cretp4ssword\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> connect\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">() \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\">*\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">sql\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">DB\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    connStr\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> fmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Sprintf\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">postgres://\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">%s\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">:\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">%s\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">@localhost/pqgotest\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">user\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">password\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    db\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> sql\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Open\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">postgres\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">connStr\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> !=\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> nil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> nil\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> db\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// bad\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">var\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    commonkey\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> []\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">byte\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">0123456789abcdef\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> AesEncrypt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">plaintext\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> string\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) (\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">string\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">error\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    block\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> aes\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">NewCipher\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">commonkey\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> !=\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> nil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\"> \"\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>\u003Cstrong>1.6.2【必须】密钥存储安全\u003C/strong>\u003C/p>\n\u003Cp>在使用对称密码算法时，需要保护好加密密钥。当算法涉及敏感、业务数据时，可通过非对称算法协商加密密钥。其他较为不敏感的数据加密，可以通过变换算法等方式保护密钥。\n不要使用弱密码算法:\u003C/p>\n\u003Cblockquote>\n\u003Cp>crypto/des，crypto/md5，crypto/sha1，crypto/rc4等。\u003C/p>\n\u003C/blockquote>\n\u003Ch3 id=\"17正则表达式\">1.7正则表达式\u003C/h3>\n\u003Cp>\u003Cstrong>1.7.1【推荐】使用regexp进行正则表达式匹配\u003C/strong>\n正则表达式能不用还是不要用哈,很耗费性能.\u003C/p>\n\u003Cp>正则表达式编写不恰当可被用于DoS攻击，造成服务不可用，推荐使用regexp包进行正则表达式匹配。regexp保证了线性时间性能和优雅的失败：对解析器、编译器和执行引擎都进行了内存限制。但regexp不支持以下正则表达式特性，如业务依赖这些特性，则regexp不适合使用。\n回溯引用Backreferences和查看Lookaround\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"background-color:#ffffff;--shiki-dark-bg:#011627;color:#24292eff;--shiki-dark:#d6deeb; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"go\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// good\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">matched\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> regexp\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">MatchString\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">`\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">a.b\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">`\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">aaxbb\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">fmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Println\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">matched\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// true\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">fmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Println\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)     \u003C/span>\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// nil (regexp is valid)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"后台类\">后台类\u003C/h3>\n\u003Ch3 id=\"11-输入校验\">1.1 输入校验\u003C/h3>\n\u003Cp>\u003Cstrong>1.1.1 按照数据进行校验\u003C/strong>\n所有外部输入的参数，应使用validator进行白名单校验，校验内容包括但不限于数据长度、数据范围、数据类型与格式，校验不通过的应当拒绝.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"background-color:#ffffff;--shiki-dark-bg:#011627;color:#24292eff;--shiki-dark:#d6deeb; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"go\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">    \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">fmt\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">    \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">github.com/go-playground/validator/v10\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 1. 基础类型验证\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> basicValidation\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">() {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    validate\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> validator\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">New\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    email\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">invalid-email\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> validate\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Var\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">email\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">required,email\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> !=\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> nil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        fmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Println\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">邮箱格式错误\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 2. 结构体验证\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">type\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\"> User\u003C/span>\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> struct\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">    ID\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">        int\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">       `\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">validate:\"required\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">`\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">    Name\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">      string\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">    `\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">validate:\"required,min=2,max=50\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">`\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">    Age\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">       uint8\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">     `\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">validate:\"required,gte=18,lte=120\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">`\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">    Email\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">     string\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">    `\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">validate:\"required,email\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">`\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">    Phone\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">     string\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">    `\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">validate:\"required,len=11\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">`\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">    Password\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">  string\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">    `\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">validate:\"required,min=8\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">`\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> structValidation\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">() {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    validate\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> validator\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">New\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    user\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">User\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">        ID\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">:       \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">1\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">        Name\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">:     \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">张三\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">        Age\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">:      \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">16\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">,  \u003C/span>\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 验证会失败，因为年龄小于18\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">        Email\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">:    \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">zhangsan@example.com\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">        Phone\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">:    \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">13800138000\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">        Password\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">: \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">password123\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> validate\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Struct\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">user\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> !=\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> nil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        validationErrors\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> err\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.(\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">validator\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">ValidationErrors\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        for\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> _\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">e\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> range\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> validationErrors\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">            fmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Printf\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">字段: \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">%s\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">, 错误: \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">%s\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#F78C6C\">\\n\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">e\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Field\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(), \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">e\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Tag\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">())\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 3. 自定义验证规则\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> customValidation\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">() {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    validate\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> validator\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">New\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 注册自定义验证器\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    validate\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">RegisterValidation\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">chinese_mobile\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">fl\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\"> validator\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">FieldLevel\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">bool\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        value\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> fl\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Field\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">().\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">String\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">        // 简单的中国手机号验\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>GoFrame 框架提供了类似的数据校验功能，通过 g.Validator() 或者 g.Validator().Rules() 来实现，主要通过 gvalid 包提供验证功能\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"background-color:#ffffff;--shiki-dark-bg:#011627;color:#24292eff;--shiki-dark:#d6deeb; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"go\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">    \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">github.com/gogf/gf/v2/util/gvalid\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">    \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">github.com/gogf/gf/v2/frame/g\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 1. 结构体验证\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">type\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\"> User\u003C/span>\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> struct\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">    Name\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">     string\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\"> `\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">v:\"required|length:6,30#请输入用户名|用户名长度应当在:min到:max之间\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">`\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">    Age\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">      uint\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">   `\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">v:\"required|between:18,60#请输入年龄|年龄应当在:min到:max之间\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">`\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">    Email\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">    string\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\"> `\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">v:\"required|email#请输入邮箱|邮箱格式不正确\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">`\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">    Password\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> string\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\"> `\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">v:\"required|length:6,30#请输入密码|密码长度应当在:min到:max之间\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">`\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> validateStruct\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">() {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    user\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">User\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">        Name\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">:     \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">john\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">        Age\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">:      \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">16\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">        Email\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">:    \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">john@example\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">        Password\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">: \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">123\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 执行校验\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> g\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Validator\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">().\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Data\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">user\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">).\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Run\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">ctx\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">); \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> !=\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> nil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        fmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Println\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">FirstString\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">()) \u003C/span>\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 输出第一条错误信息\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 2. 单个数据验证\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> validateSingle\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">() {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 验证单个数据\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> g\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Validator\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">().\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Data\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">john@example\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">).\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Rules\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">required|email\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">).\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Run\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">ctx\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">); \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> !=\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> nil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        fmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Println\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">FirstString\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">())\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 3. 自定义验证规则\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> customValidation\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">() {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 注册自定义规则\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> gvalid\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">RegisterRule\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">chinese_mobile\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">ctx\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\"> context\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">Context\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">in\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\"> gvalid\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">RuleFuncInput\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">error\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        if\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> !\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">regexp\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">MustCompile\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">`\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">^1[3-9]\\d{9}$\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">`\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">).\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">MatchString\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">in\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">Value\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">String\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">()) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">            return\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> errors\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">New\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">手机号格式错误\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> nil\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }); \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> !=\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> nil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">        panic\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 使用自定义规则\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    phone\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">12345678901\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> g\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Validator\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">().\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Data\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">phone\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">).\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Rules\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">chinese_mobile\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">).\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Run\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">ctx\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">); \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> !=\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> nil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        fmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Println\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">FirstString\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">())\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 4. Map数据验证\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> validateMap\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">() {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    data\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\"> g\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">Map\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">        \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">name\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">:  \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">john\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">        \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">age\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">:   \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">16\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">        \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">email\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">: \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">john@example\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    rules\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\"> g\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">Map\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">        \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">name\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">:  \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">required|length:6,30\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">        \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">age\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">:   \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">required|between:18,60\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">        \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">email\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">: \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">required|email\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    messages\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\"> g\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">Map\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">        \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">name\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">:  \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">用户名不能为空|用户名长度应当在{min}到{max}之间\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">        \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">age\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">:   \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">请输入年龄|年龄应当在{min}到{max}之间\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">        \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">email\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">: \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">请输入邮箱|邮箱格式不正确\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> g\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Validator\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">().\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Data\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">data\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">).\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Rules\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">rules\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">).\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Messages\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">messages\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">).\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Run\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">ctx\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">); \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> !=\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> nil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        fmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Println\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">FirstString\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">())\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>无法通过白名单校验的应使用html.EscapeString、text/template或bluemonday对&#x3C;, >, &#x26;, ’,“等字符进行过滤或编码.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"background-color:#ffffff;--shiki-dark-bg:#011627;color:#24292eff;--shiki-dark:#d6deeb; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"go\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  import\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">      \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">text/template\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">  )\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  // TestHTMLEscapeString HTML特殊字符转义\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> main\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">inputValue\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> string\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">string\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">      escapedResult\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> template\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">HTMLEscapeString\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">inputValue\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      return\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> escapedResult\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"12-sql操作-重点\">1.2 SQL操作 (重点)\u003C/h3>\n\u003Cp>\u003Cstrong>使用database/sql的prepare、Query或使用GORM等ORM执行SQL操作\u003C/strong>\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"background-color:#ffffff;--shiki-dark-bg:#011627;color:#24292eff;--shiki-dark:#d6deeb; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"go\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  import\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">    \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">github.com/jinzhu/gorm\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    _\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">github.com/jinzhu/gorm/dialects/sqlite\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">  )\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  type\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\"> Product\u003C/span>\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> struct\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">    gorm\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">Model\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">    Code\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> string\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">    Price\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> uint\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\">  ...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  var\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> product\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\"> Product\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">  db\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">First\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\">&#x26;\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">product\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">1\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>\u003Cstrong>使用参数化查询，禁止拼接SQL语句，另外对于传入参数用于order by或表名的需要通过校验\u003C/strong>\u003C/p>\n\u003Cp>SQL注入的风险 当直接拼接 SQL 语句时(bad示例),攻击者可以通过构造特殊的输入来改变 SQL 语句的原意。例如:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"background-color:#ffffff;--shiki-dark-bg:#011627;color:#24292eff;--shiki-dark:#d6deeb; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"go\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 假设攻击者输入的 category 是:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">' OR '1'='1\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 那么最终的 SQL 语句会变成:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">SELECT ITEM,PRICE FROM PRODUCT WHERE ITEM_CATEGORY='' OR '1'='1' ORDER BY PRICE\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>这样攻击者就能查询到所有商品信息,绕过了 category 的限制。更危险的是,攻击者还可能:\u003C/p>\n\u003Cul>\n\u003Cli>删除数据: ’; DROP TABLE PRODUCT;—\u003C/li>\n\u003Cli>修改数据: ’; UPDATE PRODUCT SET PRICE=0;—\u003C/li>\n\u003Cli>获取数据库结构: ’ UNION SELECT table_name,null FROM information_schema.tables;—\u003C/li>\n\u003C/ul>\n\u003Cp>使用参数化查询(good示例)时:\u003C/p>\n\u003Cul>\n\u003Cli>参数值会被当作纯文本处理,而不是 SQL 代码的一部分\u003C/li>\n\u003Cli>数据库驱动会自动对特殊字符进行转义\u003C/li>\n\u003Cli>SQL 语句的结构是固定的,不会被输入值改变\u003C/li>\n\u003C/ul>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"background-color:#ffffff;--shiki-dark-bg:#011627;color:#24292eff;--shiki-dark:#d6deeb; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"go\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// bad\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  import\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">      \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">database/sql\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">      \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">fmt\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">      \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">net/http\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">  )\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> handler\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">db\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">sql\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">DB\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">req\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">http\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">Request\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">      q\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> fmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Sprintf\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">SELECT ITEM,PRICE FROM PRODUCT WHERE ITEM_CATEGORY='\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">%s\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">' ORDER BY PRICE\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">          req\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">URL\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Query\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">()[\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">category\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">])\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">      db\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Query\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">q\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// good\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> handlerGood\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">db\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">sql\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">DB\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">req\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">http\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">Request\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    //使用?占位符\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">      q\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">SELECT ITEM,PRICE FROM PRODUCT WHERE ITEM_CATEGORY='?' ORDER BY PRICE\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">      db\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Query\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">q\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">req\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">URL\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Query\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">()[\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">category\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">])\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"13网络请求\">1.3网络请求\u003C/h2>\n\u003Ch3 id=\"131资源请求过滤验证\">1.3.1资源请求过滤验证\u003C/h3>\n\u003Cp>使用”net/http”下的方法http.Get(url)、http.Post(url, contentType, body)、http.Head(url )、http.PostForm(url, data)、http.Do(req)时，如变量值外部可控（指从参数中动态获取），应对请求目标进行严格的安全校验。\u003C/p>\n\u003Cp>如请求资源域名归属固定的范围，如只允许a.qq.com和b.qq.com，应做白名单限制。如不适用白名单，则推荐的校验逻辑步骤是：\u003C/p>\n\u003Cul>\n\u003Cli>第 1 步、只允许HTTP或HTTPS协议\u003C/li>\n\u003Cli>第 2 步、解析目标URL，获取其HOST\u003C/li>\n\u003Cli>第 3 步、解析HOST，获取HOST指向的IP地址转换成Long型\u003C/li>\n\u003Cli>第 4 步、检查IP地址是否为内网IP，网段有：\n// 以RFC定义的专有网络为例，如有自定义私有网段亦应加入禁止访问列表。\n10.0.0.0/8\n172.16.0.0/12\n192.168.0.0/16\n127.0.0.0/8\u003C/li>\n\u003Cli>第 5 步、请求URL\u003C/li>\n\u003Cli>第 6 步、如有跳转，跳转后执行1，否则绑定经校验的ip和域名，对URL发起请求\u003C/li>\n\u003C/ul>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"background-color:#ffffff;--shiki-dark-bg:#011627;color:#24292eff;--shiki-dark:#d6deeb; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"go\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  import\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">      \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">encoding/xml\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">      \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">fmt\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">      \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">os\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">  )\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> main\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">() {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      type\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\"> Person\u003C/span>\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> struct\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">          XMLName\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">   xml\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">Name\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\"> `\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">xml:\"person\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">`\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">          Id\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">        int\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">      `\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">xml:\"id,attr\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">`\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">          UserName\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> string\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">   `\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">xml:\"name>first\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">`\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">          Comment\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> string\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\"> `\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">xml:\",comment\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">`\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">      }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">      v\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">Person\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">{\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">Id\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">: \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">13\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">UserName\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">: \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">John\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">      v\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">Comment\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\"> Need more details. \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">      enc\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> xml\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">NewEncoder\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">os\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">Stdout\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">      enc\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Indent\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">  \"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">    \"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      if\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> enc\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Encode\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">v\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">); \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> !=\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> nil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">          fmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Printf\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">error: \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">%v\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#F78C6C\">\\n\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">err\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">      }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"14-服务器端渲染\">1.4 服务器端渲染\u003C/h3>\n\u003Cp>\u003Cstrong>1.4.1【必须】模板渲染过滤验证\u003C/strong>\u003C/p>\n\u003Cp>使用text/template或者html/template渲染模板时禁止将外部输入参数引入模板，或仅允许引入白名单内字符。这个也用不到,大部分都是前后端分离的.\u003C/p>\n\u003Cp>\u003Cstrong>1.5.1【必须】跨域资源共享CORS限制请求来源\u003C/strong>\nCORS请求保护不当可导致敏感信息泄漏，因此应当严格设置Access-Control-Allow-Origin使用同源策略进行保护。防止CSRF攻击.\n\u003Cstrong>参考这篇美团的文章,《如何防止CSRF攻击?》\u003C/strong>\n\u003Ca href=\"https://tech.meituan.com/2018/10/11/fe-security-csrf.html\">https://tech.meituan.com/2018/10/11/fe-security-csrf.html\u003C/a>\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"background-color:#ffffff;--shiki-dark-bg:#011627;color:#24292eff;--shiki-dark:#d6deeb; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"go\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> // good\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">  c\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> cors\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">New\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">cors\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">Options\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">      AllowedOrigins\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">: []\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">string\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">{\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">http://qq.com\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">https://qq.com\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">},\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">      AllowCredentials\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">: \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">true\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#BAEBE2\">      Debug\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">: \u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">false\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">  })\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  //引入中间件\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">  handler\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> c\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Handler\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">handler\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"16-响应输出\">1.6 响应输出\u003C/h3>\n\u003Cp>\u003Cstrong>设置正确的HTTP响应包类型\u003C/strong>\n响应头Content-Type与实际响应内容，应保持一致。如：API响应数据类型是json，则响应头使用application/json；若为xml，则设置为text/xml\u003C/p>\n\u003Cp>\u003Cstrong>添加安全响应头\u003C/strong>\n所有接口、页面，添加响应头 X-Content-Type-Options: nosniff。\n所有接口、页面，添加响应头X-Frame-Options。按需合理设置其允许范围，包括：DENY、SAMEORIGIN、ALLOW-FROM origin。\u003C/p>\n\u003Cp>用法参考：MDN文档\u003Ca href=\"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/X-Frame-Options\">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/X-Frame-Options\u003C/a>\u003C/p>\n\u003Cp>\u003Cstrong>外部输入拼接到HTTP响应头中需进行过滤\u003C/strong>\n应尽量避免外部可控参数拼接到HTTP响应头中，如业务需要则需要过滤掉\\r、\\n等换行符，或者拒绝携带换行符号的外部输入。\u003C/p>\n\u003Cp>\u003Cstrong>外部输入拼接到response页面前进行编码处理\u003C/strong>\n直出html页面或使用模板生成html页面的，推荐使用text/template自动编码，或者使用html.EscapeString或text/template对&#x3C;, >, &#x26;, ’,“等字符进行编码。\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"background-color:#ffffff;--shiki-dark-bg:#011627;color:#24292eff;--shiki-dark:#d6deeb; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"go\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">    \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">html/template\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)        \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> outtemplate\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">w\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\"> http\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">ResponseWriter\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">r\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">http\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">Request\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    param1\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> r\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">URL\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Query\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">().\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Get\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">param1\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    tmpl\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> template\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">New\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">hello\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    tmpl\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">_\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> tmpl\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Parse\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">`\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">{{define \"T\"}}{{.}}{{end}}\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">`\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    tmpl\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">ExecuteTemplate\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">w\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">T\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">param1\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"17-会话管理\">1.7 会话管理\u003C/h3>\n\u003Cp>\u003Cstrong>安全维护session信息\u003C/strong>\n用户登录时应重新生成session，退出登录后应清理session。\n现在用的JWT比较多,作为参考就行.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"background-color:#ffffff;--shiki-dark-bg:#011627;color:#24292eff;--shiki-dark:#d6deeb; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"go\">\u003Ccode>\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">#### \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#FFFFFF\">1.7.2\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">【\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">必须\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">】\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">CSRF防护\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">-\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> 涉及系统敏感操作或可读取敏感信息的接口应校验\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">`\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">Referer\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">`\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">或添加\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">`\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">csrf_token\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">`\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">。\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">```\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">go\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">// good\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">import (\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">    \"net/http\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">    \"github.com/gorilla/csrf\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">    \"github.com/gorilla/mux\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">func main() {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">    r := mux.NewRouter()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">    r.HandleFunc(\"/signup\", ShowSignupForm)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">    r.HandleFunc(\"/signup/post\", SubmitSignupForm)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">    //使用csrf_token验证\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">    http.ListenAndServe(\":8000\",\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">        csrf.Protect([]byte(\"32-byte-long-auth-key\"))(r))\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"18-访问控制\">1.8 访问控制\u003C/h3>\n\u003Cp>\u003Cstrong>默认鉴权\u003C/strong>\n除非资源完全可对外开放，否则系统默认进行身份认证，使用白名单的方式放开不需要认证的接口或页面。\u003C/p>\n\u003Cp>根据资源的机密程度和用户角色，以最小权限原则，设置不同级别的权限，如完全公开、登录可读、登录可写、特定用户可读、特定用户可写等\u003C/p>\n\u003Cp>涉及用户自身相关的数据的读写必须验证登录态用户身份及其权限，避免越权操作\u003C/p>\n\u003Cblockquote>\n\u003Cp>select id from table where id=:id and userid=session.userid\u003C/p>\n\u003C/blockquote>\n\u003Cp>没有独立账号体系的外网服务使用QQ或微信登录，内网服务使用统一登录服务登录，其他使用账号密码登录的服务需要增加验证码等二次验证\u003C/p>\n\u003Ch3 id=\"19-并发保护\">1.9 并发保护\u003C/h3>\n\u003Cp>\u003Cstrong>1.9.1【必须】禁止在闭包中直接调用循环变量\u003C/strong>\n在循环中启动协程，当协程中使用到了循环的索引值，由于多个协程同时使用同一个变量会产生数据竞争，造成执行结果异常。 这个是要注意的.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"background-color:#ffffff;--shiki-dark-bg:#011627;color:#24292eff;--shiki-dark:#d6deeb; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"go\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// bad\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> main\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">() {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    runtime\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">GOMAXPROCS\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">runtime\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">NumCPU\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">())\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    var\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> group\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\"> sync\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">WaitGroup\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    for\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> i\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\"> 0\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">; \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">i\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> &#x3C;\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\"> 5\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">; \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">i\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">++\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        group\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Add\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">1\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        go\u003C/span>\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> func\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">() {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">            defer\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> group\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Done\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">            fmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Printf\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">%-2d\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">i\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">//这里打印的i不是所期望的\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">        }()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    group\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Wait\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// good\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> main\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">() {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    runtime\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">GOMAXPROCS\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">runtime\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">NumCPU\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">())\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    var\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> group\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\"> sync\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">WaitGroup\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    for\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> i\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\"> 0\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">; \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">i\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> &#x3C;\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\"> 5\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">; \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">i\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">++\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        group\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Add\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">1\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        go\u003C/span>\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> func\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">j\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> int\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">            defer\u003C/span>\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> func\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">() {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">                if\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> r\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> recover\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(); \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">r\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> !=\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\"> nil\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">                    fmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Println\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">Recovered in start()\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">                }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">                group\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Done\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">            }()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        fmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Printf\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#FF5874\">%-2d\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">j\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 闭包内部使用局部变量\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">        }(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">i\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)  \u003C/span>\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 把循环变量显式地传给协程\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    group\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Wait\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">**\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#FFFFFF\">1.9.2\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">【\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">必须\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">】\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">禁止并发写map\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">**\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">并发写map容易造成程序崩溃并异常退出\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">，\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">建议加锁保护\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">```\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">go\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">// bad\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">func main() {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">  m := make(map[int]int)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">  //并发读写\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">  go func() {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">      for {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">          _ = m[1] \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">      }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">  }()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">  go func() {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">      for {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">          m[2] = 1\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">      }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">  }()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">  select {}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>\u003Cstrong>1.9.3【必须】确保并发安全\u003C/strong>\u003C/p>\n\u003Cp>敏感操作如果未作并发安全限制，可导致数据读写异常，造成业务逻辑限制被绕过。可通过同步锁或者原子操作进行防护。\u003C/p>\n\u003Cp>PS 原子操作只能操作单个变量,不能控制区间代码的逻辑,锁可以,当需要操作多个变量或复杂逻辑时,需要使用互斥锁.\u003C/p>\n\u003Cp>通过同步锁共享内存\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"background-color:#ffffff;--shiki-dark-bg:#011627;color:#24292eff;--shiki-dark:#d6deeb; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"go\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// good\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">var\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> count\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> int\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> Count\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">lock\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\"> *\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">sync\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">Mutex\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    lock\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Lock\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 加写锁\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    count\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">++\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    fmt\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Println\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">count\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    lock\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Unlock\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 解写锁，任何一个Lock()或RLock()均需要保证对应有Unlock()或RUnlock()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> main\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">() {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    lock\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\"> &#x26;\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">sync\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">Mutex\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">{}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    for\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> i\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\"> 0\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">; \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">i\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> &#x3C;\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\"> 10\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">; \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">i\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">++\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        go\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> Count\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">lock\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">//传递指针是为了防止函数内的锁和调用锁不一致\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    for\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        lock\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Lock\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        c\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> count\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        lock\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Unlock\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        runtime\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Gosched\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">//交出时间片给协程\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        if\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> c\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> >\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\"> 10\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">            break\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>使用sync/atomic执行原子操作\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"background-color:#ffffff;--shiki-dark-bg:#011627;color:#24292eff;--shiki-dark:#d6deeb; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"go\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// good\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> (\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">    \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">sync\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">    \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">sync/atomic\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> main\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">() {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    type\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\"> Map\u003C/span>\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> map\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">string\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">]\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">string\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    var\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> m\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\"> atomic\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">Value\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    m\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Store\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">make\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">Map\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">))\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    var\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> mu\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\"> sync\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">Mutex\u003C/span>\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> // used only by writers\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    read\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> func\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">key\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> string\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) (\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">val\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> string\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        m1\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> m\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Load\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">().(\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">Map\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> m1\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">key\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    insert\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> func\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">key\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D7DBE0\">val\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> string\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        mu\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Lock\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">() \u003C/span>\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 与潜在写入同步\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        defer\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> mu\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Unlock\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        m1\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> m\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Load\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">().(\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">Map\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) \u003C/span>\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 导入struct当前数据\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        m2\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> make\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#D6DEEB\">Map\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)      \u003C/span>\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 创建新值\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        for\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> k\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">v\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> :=\u003C/span>\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> range\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> m1\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">            m2\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">k\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">] \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> v\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        m2\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">[\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">key\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">] \u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> val\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">        m\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">.\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Store\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">m2\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)   \u003C/span>\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 用新的替代当前对象\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">    _\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">_\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\"> =\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\"> read\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">, \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">insert\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>",{"headings":25,"imagePaths":80,"frontmatter":11},[26,29,32,35,38,41,44,47,50,52,55,58,62,65,68,71,74,77],{"depth":27,"slug":28,"text":28},3,"通用类",{"depth":27,"slug":30,"text":31},"11内存管理","1.1内存管理",{"depth":27,"slug":33,"text":34},"12文件操作","1.2文件操作",{"depth":27,"slug":36,"text":37},"13-系统接口","1.3 系统接口",{"depth":27,"slug":39,"text":40},"14-通信安全","1.4 通信安全",{"depth":27,"slug":42,"text":43},"15-敏感数据保护","1.5 敏感数据保护",{"depth":27,"slug":45,"text":46},"16加密解密","1.6加密解密",{"depth":27,"slug":48,"text":49},"17正则表达式","1.7正则表达式",{"depth":27,"slug":51,"text":51},"后台类",{"depth":27,"slug":53,"text":54},"11-输入校验","1.1 输入校验",{"depth":27,"slug":56,"text":57},"12-sql操作-重点","1.2 SQL操作 (重点)",{"depth":59,"slug":60,"text":61},2,"13网络请求","1.3网络请求",{"depth":27,"slug":63,"text":64},"131资源请求过滤验证","1.3.1资源请求过滤验证",{"depth":27,"slug":66,"text":67},"14-服务器端渲染","1.4 服务器端渲染",{"depth":27,"slug":69,"text":70},"16-响应输出","1.6 响应输出",{"depth":27,"slug":72,"text":73},"17-会话管理","1.7 会话管理",{"depth":27,"slug":75,"text":76},"18-访问控制","1.8 访问控制",{"depth":27,"slug":78,"text":79},"19-并发保护","1.9 并发保护",[],"how-to-add-latex-equations-in-blog-posts",{"id":81,"data":83,"body":91,"filePath":92,"digest":93,"rendered":94},{"author":84,"pubDatetime":85,"modDatetime":86,"title":87,"featured":15,"draft":15,"tags":88,"description":90},"Alberto Perdomo",["Date","2024-09-08T20:58:52.737Z"],["Date","2025-02-05T10:40:08.460Z"],"Adding LaTeX Equations in AstroPaper blog posts",[89],"docs","How to use LaTeX equations in your Markdown files for AstroPaper.","\nThis document demonstrates how to use LaTeX equations in your Markdown files for AstroPaper. LaTeX is a powerful typesetting system often used for mathematical and scientific documents.\n\n## Table of contents\n\n## Instructions\n\nIn this section, you will find instructions on how to add support for LaTeX in your Markdown files for AstroPaper.\n\n1. Install the necessary remark and rehype plugins by running `npm install rehype-katex remark-math katex`.\n\n2. Update the Astro configuration (`astro.config.ts`) to use the these plugins:\n\n```ts\n// other imports\nimport remarkMath from \"remark-math\";\nimport rehypeKatex from \"rehype-katex\";\n\nexport default defineConfig({\n  // other configs\n  markdown: {\n    remarkPlugins: [\n      remarkMath,\n      remarkToc,\n      [\n        remarkCollapse,\n        {\n          test: \"Table of contents\",\n        },\n      ],\n    ],\n    rehypePlugins: [rehypeKatex],\n    // other markdown configs\n  },\n  // other configs\n});\n```\n\n3. Import KaTeX CSS in the main layout file `src/layouts/Layout.astro`\n\n```astro\n---\nimport { LOCALE, SITE } from \"@config\";\n\n// astro code\n---\n\n\u003C!doctype html>\n\u003C!-- others... -->\n\u003Cscript is:inline src=\"/toggle-theme.js\">\u003C/script>\n\u003Clink\n  rel=\"stylesheet\"\n  href=\"https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css\"\n/>\n\n\u003Cbody>\n  \u003Cslot />\n\u003C/body>\n```\n\nAnd _voilà_, this setup allows you to write LaTeX equations in your Markdown files, which will be rendered properly when the site is built. Once you do it, the rest of the document will appear rendered correctly.\n\n## Inline Equations\n\nInline equations are written between single dollar signs `$...$`. Here are some examples:\n\n1. The famous mass-energy equivalence formula: `$E = mc^2$`\n2. The quadratic formula: `$x = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$`\n3. Euler's identity: `$e^{i\\pi} + 1 = 0$`\n\n## Block Equations\n\nFor more complex equations or when you want the equation to be displayed on its own line, use double dollar signs `$$...$$`:\n\nThe Gaussian integral:\n\n```bash\n$$ \\int_{-\\infty}^{\\infty} e^{-x^2} dx = \\sqrt{\\pi} $$\n```\n\nThe definition of the Riemann zeta function:\n\n```bash\n$$ \\zeta(s) = \\sum_{n=1}^{\\infty} \\frac{1}{n^s} $$\n```\n\nMaxwell's equations in differential form:\n\n```bash\n$$\n\\begin{aligned}\n\\nabla \\cdot \\mathbf{E} &= \\frac{\\rho}{\\varepsilon_0} \\\\\n\\nabla \\cdot \\mathbf{B} &= 0 \\\\\n\\nabla \\times \\mathbf{E} &= -\\frac{\\partial \\mathbf{B}}{\\partial t} \\\\\n\\nabla \\times \\mathbf{B} &= \\mu_0\\left(\\mathbf{J} + \\varepsilon_0 \\frac{\\partial \\mathbf{E}}{\\partial t}\\right)\n\\end{aligned}\n$$\n```\n\n## Using Mathematical Symbols\n\nLaTeX provides a wide range of mathematical symbols:\n\n- Greek letters: `$\\alpha$`, `$\\beta$`, `$\\gamma$`, `$\\delta$`, `$\\epsilon$`, `$\\pi$`\n- Operators: `$\\sum$`, `$\\prod$`, `$\\int$`, `$\\partial$`, `$\\nabla$`\n- Relations: `$\\leq$`, `$\\geq$`, `$\\approx$`, `$\\sim$`, `$\\propto$`\n- Logical symbols: `$\\forall$`, `$\\exists$`, `$\\neg$`, `$\\wedge$`, `$\\vee$`\n","src/content/blog/how-to-add-latex-equations-in-blog-posts.md","0a914b063e386329",{"html":95,"metadata":96},"\u003Cp>This document demonstrates how to use LaTeX equations in your Markdown files for AstroPaper. LaTeX is a powerful typesetting system often used for mathematical and scientific documents.\u003C/p>\n\u003Ch2 id=\"table-of-contents\">Table of contents\u003C/h2>\n\u003Cp>\u003C/p>\u003Cdetails>\u003Csummary>Open Table of contents\u003C/summary>\u003Cp>\u003C/p>\n\u003Cul>\n\u003Cli>\u003Ca href=\"#instructions\">Instructions\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#inline-equations\">Inline Equations\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#block-equations\">Block Equations\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"#using-mathematical-symbols\">Using Mathematical Symbols\u003C/a>\u003C/li>\n\u003C/ul>\n\u003Cp>\u003C/p>\u003C/details>\u003Cp>\u003C/p>\n\u003Ch2 id=\"instructions\">Instructions\u003C/h2>\n\u003Cp>In this section, you will find instructions on how to add support for LaTeX in your Markdown files for AstroPaper.\u003C/p>\n\u003Col>\n\u003Cli>\n\u003Cp>Install the necessary remark and rehype plugins by running \u003Ccode>npm install rehype-katex remark-math katex\u003C/code>.\u003C/p>\n\u003C/li>\n\u003Cli>\n\u003Cp>Update the Astro configuration (\u003Ccode>astro.config.ts\u003C/code>) to use the these plugins:\u003C/p>\n\u003C/li>\n\u003C/ol>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"background-color:#ffffff;--shiki-dark-bg:#011627;color:#24292eff;--shiki-dark:#d6deeb; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"ts\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// other imports\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> remarkMath \u003C/span>\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">remark-math\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> rehypeKatex \u003C/span>\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">rehype-katex\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">export\u003C/span>\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> default\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> defineConfig\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  // other configs\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">  markdown\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    remarkPlugins\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> [\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">      remarkMath\u003C/span>\u003Cspan style=\"color:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">      remarkToc\u003C/span>\u003Cspan style=\"color:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">      [\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">        remarkCollapse\u003C/span>\u003Cspan style=\"color:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">        {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">          test\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">Table of contents\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">        }\u003C/span>\u003Cspan style=\"color:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">      ]\u003C/span>\u003Cspan style=\"color:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    ]\u003C/span>\u003Cspan style=\"color:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">    rehypePlugins\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#D6DEEB\">:\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> [rehypeKatex]\u003C/span>\u003Cspan style=\"color:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // other markdown configs\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">  }\u003C/span>\u003Cspan style=\"color:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  // other configs\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Col start=\"3\">\n\u003Cli>Import KaTeX CSS in the main layout file \u003Ccode>src/layouts/Layout.astro\u003C/code>\u003C/li>\n\u003C/ol>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"background-color:#ffffff;--shiki-dark-bg:#011627;color:#24292eff;--shiki-dark:#d6deeb; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"astro\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">---\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> { LOCALE\u003C/span>\u003Cspan style=\"color:#212121;--shiki-dark:#D6DEEB\">,\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\"> SITE } \u003C/span>\u003Cspan style=\"color:#D32F2F;font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\"> \"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">@config\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// astro code\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">---\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;!\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#CAECE6\">doctype\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> html\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#7FDBCA\">>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#C2C3C5;font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">&#x3C;!-- others... -->\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#CAECE6\">script\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> is:inline\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> src\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">/toggle-theme.js\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#7FDBCA\">>&#x3C;/\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#CAECE6\">script\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#7FDBCA\">>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#CAECE6\">link\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">  rel\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">stylesheet\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">  href\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#7FDBCA\">=\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#ECC48D\">https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#D9F5DD\">\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#7FDBCA\">/>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#CAECE6\">body\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#7FDBCA\">>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#7FDBCA\">  &#x3C;\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#CAECE6\">slot\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#7FDBCA\"> />\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;/\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-dark:#CAECE6\">body\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#7FDBCA\">>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>And \u003Cem>voilà\u003C/em>, this setup allows you to write LaTeX equations in your Markdown files, which will be rendered properly when the site is built. Once you do it, the rest of the document will appear rendered correctly.\u003C/p>\n\u003Ch2 id=\"inline-equations\">Inline Equations\u003C/h2>\n\u003Cp>Inline equations are written between single dollar signs \u003Ccode>$...$\u003C/code>. Here are some examples:\u003C/p>\n\u003Col>\n\u003Cli>The famous mass-energy equivalence formula: \u003Ccode>$E = mc^2$\u003C/code>\u003C/li>\n\u003Cli>The quadratic formula: \u003Ccode>$x = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$\u003C/code>\u003C/li>\n\u003Cli>Euler’s identity: \u003Ccode>$e^{i\\pi} + 1 = 0$\u003C/code>\u003C/li>\n\u003C/ol>\n\u003Ch2 id=\"block-equations\">Block Equations\u003C/h2>\n\u003Cp>For more complex equations or when you want the equation to be displayed on its own line, use double dollar signs \u003Ccode>$$...$$\u003C/code>:\u003C/p>\n\u003Cp>The Gaussian integral:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"background-color:#ffffff;--shiki-dark-bg:#011627;color:#24292eff;--shiki-dark:#d6deeb; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"bash\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#7FDBCA\">$$\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#F78C6C\"> \\i\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">nt_{\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">-\\infty}^\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\">{\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">\\\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\">infty}\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\"> e^{-x^2}\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\"> dx\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\"> =\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#F78C6C\"> \\s\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\">qrt{\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#F78C6C\">\\p\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\">i}\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#7FDBCA\"> $$\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>The definition of the Riemann zeta function:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"background-color:#ffffff;--shiki-dark-bg:#011627;color:#24292eff;--shiki-dark:#d6deeb; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"bash\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#7FDBCA\">$$\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#F78C6C\"> \\z\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">eta(\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">s\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">) = \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#F78C6C\">\\s\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">um_{\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#C5E478\">n\u003C/span>\u003Cspan style=\"color:#D32F2F;--shiki-dark:#C792EA\">=\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\">1\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">}^{\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">\\infty}\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#F78C6C\"> \\f\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\">rac{\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\">1\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\">}{n^s}\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#7FDBCA\"> $$\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Maxwell’s equations in differential form:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes min-light night-owl\" style=\"background-color:#ffffff;--shiki-dark-bg:#011627;color:#24292eff;--shiki-dark:#d6deeb; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;\" tabindex=\"0\" data-language=\"bash\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#7FDBCA\">$$\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">\\begin\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\">{aligned}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">\\nabla\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#F78C6C\"> \\c\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\">dot\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#F78C6C\"> \\m\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\">athbf{E}\u003C/span>\u003Cspan style=\"color:#212121;--shiki-dark:#D6DEEB\"> &#x26;\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\">=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#F78C6C\"> \\f\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\">rac{\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#F78C6C\">\\r\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\">ho}{\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#F78C6C\">\\v\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\">arepsilon_0}\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#F78C6C\"> \\\\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#F78C6C\">\\n\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">abla \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#F78C6C\">\\c\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\">dot\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#F78C6C\"> \\m\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\">athbf{B}\u003C/span>\u003Cspan style=\"color:#212121;--shiki-dark:#D6DEEB\"> &#x26;\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\">=\u003C/span>\u003Cspan style=\"color:#1976D2;--shiki-dark:#F78C6C\"> 0\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#F78C6C\"> \\\\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#F78C6C\">\\n\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">abla \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#F78C6C\">\\t\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\">imes\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#F78C6C\"> \\m\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\">athbf{E}\u003C/span>\u003Cspan style=\"color:#212121;--shiki-dark:#D6DEEB\"> &#x26;\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\">=\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#82AAFF\"> -\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#F78C6C\">\\f\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#82AAFF\">rac\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">{\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">\\partial\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#F78C6C\"> \\m\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\">athbf{B}}{\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#F78C6C\">\\p\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\">artial\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\"> t}\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#F78C6C\"> \\\\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#F78C6C\">\\n\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">abla \u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#F78C6C\">\\t\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\">imes\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#F78C6C\"> \\m\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\">athbf{B}\u003C/span>\u003Cspan style=\"color:#212121;--shiki-dark:#D6DEEB\"> &#x26;\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\">=\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#F78C6C\"> \\m\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\">u_0\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#F78C6C\">\\l\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\">eft\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">(\u003C/span>\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">\\mathbf\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\">{J}\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\"> +\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#F78C6C\"> \\v\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\">arepsilon_0\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#F78C6C\"> \\f\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\">rac{\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#F78C6C\">\\p\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\">artial\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#F78C6C\"> \\m\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\">athbf{E}}{\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#F78C6C\">\\p\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\">artial\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\"> t}\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#F78C6C\">\\r\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\">ight\u003C/span>\u003Cspan style=\"color:#24292EFF;--shiki-dark:#D6DEEB\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6F42C1;font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">\\end\u003C/span>\u003Cspan style=\"color:#2B5581;--shiki-dark:#ECC48D\">{aligned}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292EFF;--shiki-dark:#7FDBCA\">$$\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"using-mathematical-symbols\">Using Mathematical Symbols\u003C/h2>\n\u003Cp>LaTeX provides a wide range of mathematical symbols:\u003C/p>\n\u003Cul>\n\u003Cli>Greek letters: \u003Ccode>$\\alpha$\u003C/code>, \u003Ccode>$\\beta$\u003C/code>, \u003Ccode>$\\gamma$\u003C/code>, \u003Ccode>$\\delta$\u003C/code>, \u003Ccode>$\\epsilon$\u003C/code>, \u003Ccode>$\\pi$\u003C/code>\u003C/li>\n\u003Cli>Operators: \u003Ccode>$\\sum$\u003C/code>, \u003Ccode>$\\prod$\u003C/code>, \u003Ccode>$\\int$\u003C/code>, \u003Ccode>$\\partial$\u003C/code>, \u003Ccode>$\\nabla$\u003C/code>\u003C/li>\n\u003Cli>Relations: \u003Ccode>$\\leq$\u003C/code>, \u003Ccode>$\\geq$\u003C/code>, \u003Ccode>$\\approx$\u003C/code>, \u003Ccode>$\\sim$\u003C/code>, \u003Ccode>$\\propto$\u003C/code>\u003C/li>\n\u003Cli>Logical symbols: \u003Ccode>$\\forall$\u003C/code>, \u003Ccode>$\\exists$\u003C/code>, \u003Ccode>$\\neg$\u003C/code>, \u003Ccode>$\\wedge$\u003C/code>, \u003Ccode>$\\vee$\u003C/code>\u003C/li>\n\u003C/ul>",{"headings":97,"imagePaths":113,"frontmatter":83},[98,101,104,107,110],{"depth":59,"slug":99,"text":100},"table-of-contents","Table of contents",{"depth":59,"slug":102,"text":103},"instructions","Instructions",{"depth":59,"slug":105,"text":106},"inline-equations","Inline Equations",{"depth":59,"slug":108,"text":109},"block-equations","Block Equations",{"depth":59,"slug":111,"text":112},"using-mathematical-symbols","Using Mathematical Symbols",[]]